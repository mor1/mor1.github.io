<!doctype html><html lang=en><head><link href="https://mort.io/abridge.css?h=ef0df812e427238e124c" rel=stylesheet><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1" name=viewport><meta content=https://mort.io name=base><meta content=True name=HandheldFriendly><meta content=yes name=mobile-web-app-capable><meta content=yes name=apple-mobile-web-app-capable><meta content=default name=apple-mobile-web-app-status-bar-style><link title="mort’s mythopœia Atom Feed" href=https://mort.io/atom.xml rel=alternate type=application/atom+xml><link title="mort’s mythopœia RSS Feed" href=https://mort.io/rss.xml rel=alternate type=application/rss+xml><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>Resizing swap partition on NixOS | mort’s mythopœia</title><meta content="mort’s mythopœia" name=copyright><meta content="Tl;dr--- you can't so delete and recreate it instead." name=description><link href=https://mort.io/blog/resize-swap/ rel=canonical><meta content=https://mort.io/blog/resize-swap/ property=og:url><meta content=https://mort.io/blog/resize-swap/ name=twitter:url><meta content="Tl;dr--- you can't so delete and recreate it instead." property=og:description><meta content="Tl;dr--- you can't so delete and recreate it instead." name=twitter:description><meta content="Resizing swap partition on NixOS | mort’s mythopœia" property=og:title><meta content="Resizing swap partition on NixOS | mort’s mythopœia" name=twitter:title><meta content=summary name=twitter:card><meta content="mort’s mythopœia" property=og:site_name><meta content=en_US property=og:locale><meta content=website property=og:type><meta content=2025-08-13 property=og:updated_time><noscript><link href=https://mort.io/nojs.css rel=stylesheet></noscript><body><header><nav><div><big><a title="mort’s mythopœia" href=https://mort.io>mort’s mythopœia</a></big></div><div><div><ul><li><a class=s110 href=https://mort.io/research/> research </a><li><a class=s110 href=https://mort.io/students/> students </a><li><a class=s110 href=https://mort.io/teaching/> teaching </a><li><a class=s110 href=https://mort.io/codes/> codes </a><li><a class=s110 href=https://mort.io/me/> me </a></ul></div><div></div></div></nav><div class=desc>with apologies</div><hr></header><main><article><h1><a href=https://mort.io/blog/resize-swap/>Resizing swap partition on NixOS</a></h1><span class=s95><span class=hpad> ·</span> 2 min read<span class=hpad> ·</span> August 13, 2025<span class=hpad> ·</span> #<a href=https://mort.io/tags/nixos/>nixos</a> #<a href=https://mort.io/tags/linux/>linux</a> #<a href=https://mort.io/tags/tech/>tech</a> </span><nav><div><a href=https://mort.io/blog/orating-honors/>‹ Orating honours</a></div><div><a href=https://mort.io/blog/keymapping-reprise/> Re-key-remapping ›</a></div></nav><p>I recently decided that I had over-egged the pudding and allocated too much space to my swap partition (mounted as <code>/tmp</code>) under NixOS. At the same time, it had got to the point where I was bouncing off the ceiling a little with the other two partitions, <code>/home</code> and <code>/</code> (wherein lives the Nix store).<p>I tried <code>gparted</code> first for a handy GUI but got nowhere due to (I think) Wayland:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> nix profile install nixpkgs#gparted.out</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">...</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> gparted</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">localuser:root</span></span><span class="z-meta z-function-call z-arguments z-shell"> being added to access control list</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Error</span></span><span class="z-meta z-function-call z-arguments z-shell"> executing command as another user: No authentication agent found.</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">localuser:root</span></span><span class="z-meta z-function-call z-arguments z-shell"> being removed from access control list</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> sudo gparted</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Invalid</span></span><span class="z-meta z-function-call z-arguments z-shell"> MIT-MAGIC-COOKIE-1 key</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-punctuation z-definition z-compound z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">gpartedbin:360533</span></span><span class="z-punctuation z-definition z-compound z-end z-shell">)</span><span class="z-meta z-function-call z-arguments z-shell">: Gtk-WARNING <span class="z-keyword z-operator z-regexp z-quantifier z-shell">*</span><span class="z-keyword z-operator z-regexp z-quantifier z-shell">*</span>: 19:19:25.626: cannot open display: :0</span>
</span></code></pre><p>So the obvious solution was to reduce the size of the swap partition and increase the other two. However, doing this for my setup – a LUKS-encrypted device partitioned using Logical Volume Manager (LVM) – turned out to be a little less obvious than it might have been, and searching the interwebs turned up several not quite correct answers, I thought I’d make a note here.<p>NB. Don’t pay too much attention to the sizes of partitions below: I cribbed these notes from shell history but re-ran some commands to get the output as I’d already closed that shell so they may not be entirely coherent. The commands should be right though.<ol><li><p>Find your partition names using <code>lvscan</code>:</p> <pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> sudo lvscan</span>
</span><span class="z-source z-shell z-bash">  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ACTIVE</span></span><span class="z-meta z-function-call z-arguments z-shell">            <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>/dev/vg0/home<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>&LT729.61 GiB<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> inherit</span>
</span><span class="z-source z-shell z-bash">  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ACTIVE</span></span><span class="z-meta z-function-call z-arguments z-shell">            <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>/dev/vg0/nixos<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>94.00 GiB<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> inherit</span>
</span><span class="z-source z-shell z-bash">  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ACTIVE</span></span><span class="z-meta z-function-call z-arguments z-shell">            <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>/dev/vg0/nixos-swap<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>16.00 GiB<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> inherit</span>
</span></code></pre> <p>Normally I would then just use <code>lvreduce</code> – but that fails on the swap partition:</p> <pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> sudo lvreduce<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>r</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>size</span> 12GiB /dev/vg0/nixos-swap</span>
</span><span class="z-source z-shell z-bash">  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">File</span></span><span class="z-meta z-function-call z-arguments z-shell"> system swap found on vg0/nixos-swap.</span>
</span><span class="z-source z-shell z-bash">  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">File</span></span><span class="z-meta z-function-call z-arguments z-shell"> system size (16.00 GiB</span><span class="z-meta z-function-call z-shell"></span>) <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">is</span></span><span class="z-meta z-function-call z-arguments z-shell"> larger than the requested size (12.00 GiB</span><span class="z-meta z-function-call z-shell"></span>)<span class="z-meta z-function-call z-shell"><span class="z-support z-function z-dot z-shell">.</span></span>
</span><span class="z-source z-shell z-bash">  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">File</span></span><span class="z-meta z-function-call z-arguments z-shell"> system reduce is required and not supported (swap</span><span class="z-meta z-function-call z-shell"></span>)<span class="z-meta z-function-call z-shell"><span class="z-support z-function z-dot z-shell">.</span></span>
</span></code></pre> <p>So instead…</p><li><p>Delete the swap partition and recreate to the desired size (16GB in my case):</p> <pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> lvremove /dev/vg0/nixos-swap</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> lvcreate<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>L</span> 16G<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>n</span> nixos-swap vg0</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> mkswap /dev/vg0/nixos-swap</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> swapon<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>v</span> /dev/vg0/nixos-swap</span>
</span></code></pre><li><p>Reallocate the now available space to other partitions:</p> <pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> `/home` is easy: extend logical volume and resize the filesystem at in one go:</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> sudo lvextend<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>r</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>L</span> +16G /dev/vg0/home</span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> however, can't resize the root filesystem as part of the `lvextend` because it's read-only.</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> instead, find the relevant filesystem:</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> df<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>Th</span> /</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Filesystem</span></span><span class="z-meta z-function-call z-arguments z-shell">                                             Type  Size  Used Avail Use<span class="z-meta z-group z-expansion z-job z-shell"><span class="z-punctuation z-definition z-variable z-job z-shell">%</span></span> Mounted on</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/dev/disk/by-uuid/8dd0d118-375f-4e8b-84bc-1a05b68889b7</span></span><span class="z-meta z-function-call z-arguments z-shell"> ext4   92G   66G   22G  76<span class="z-meta z-group z-expansion z-job z-shell"><span class="z-punctuation z-definition z-variable z-job z-shell">%</span></span> /</span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> ...and then manually resize it after extending the logical volume:</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> sudo lvextend<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>L</span> +12G /dev/vg0/nixos</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> sudo resize2fs /dev/disk/by-uuid/8dd0d118-375f-4e8b-84bc-1a05b68889b7</span>
</span></code></pre></ol><p>And that’s it. Swap partition is reduced in size, and the space is reallocated to the other two partitions, <code>/home</code> and <code>/</code>.<nav><div><a href=https://mort.io/blog/orating-honors/>‹ Orating honours</a></div><div><a href=https://mort.io/blog/keymapping-reprise/> Re-key-remapping ›</a></div></nav><aside class=updates><ul><li>2025-09-05: …and if you use UUIDs to refer to disk partitions, don’t forget to <code>nixos-generate-config</code> or otherwise update them!</ul></aside></article></main><footer><hr><div class=c><nav class=tpad><div><a title="mort’s mythopœia Atom Feed" href=https://mort.io/atom.xml target=_blank type=application/atom+xml><i class="svg rss" title="mort’s mythopœia Atom Feed" type=Button></i></a><a title="mort’s mythopœia RSS Feed" href=https://mort.io/rss.xml target=_blank type=application/rss+xml><i class="svg rss" title="mort’s mythopœia RSS Feed" type=Button></i></a><a href=mailto:richard.mortier@cl.cam.ac.uk target=_blank title=Mail><i class="svg mail" title=Mail type=Button></i></a><a href=https://mastodon.me.uk/@mort rel=me target=_blank title=Mastodon><i class="svg mastodon" title=Mastodon type=Button></i></a><a href=https://www.linkedin.com/in/richard-mortier/ target=_blank title=LinkedIn><i class="svg linkedin" title=LinkedIn type=Button></i></a><a href=https://github.com/mor1/ target=_blank title=Github><i class="svg github" title=Github type=Button></i></a><a href=https://hub.docker.com/u/mor1/ target=_blank title=Docker><i class="svg docker" title=Docker type=Button></i></a><a href="https://www.youtube.com/playlist?list=PLkRF0fgqvvMx5Owh1QgilmExGQe58go_u" target=_blank title=YouTube><i class="svg youtube" title=YouTube type=Button></i></a></div></nav><nav class=vpad><a class=rpad href=https://mort.io/sitemap.xml target=_blank> sitemap </a><a class=rpad href=https://mort.io/tags/> tags </a></nav><p class=s90>mort’s mythopœia © 2013—<span id=year>2025</span> Richard Mortier</div></footer>