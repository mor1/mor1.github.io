<!doctype html><html lang=en><head><link href="https://mort.io/abridge.css?h=ef0df812e427238e124c" rel=stylesheet><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1" name=viewport><meta content=https://mort.io name=base><meta content=True name=HandheldFriendly><meta content=yes name=mobile-web-app-capable><meta content=yes name=apple-mobile-web-app-capable><meta content=default name=apple-mobile-web-app-status-bar-style><link title="mort’s mythopœia Atom Feed" href=https://mort.io/atom.xml rel=alternate type=application/atom+xml><link title="mort’s mythopœia RSS Feed" href=https://mort.io/rss.xml rel=alternate type=application/rss+xml><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>`just` OCaml | mort’s mythopœia</title><meta content="mort’s mythopœia" name=copyright><meta content="...yes, I prefer `just` to `make` now" name=description><link href=https://mort.io/blog/just-ocaml/ rel=canonical><meta content=https://mort.io/blog/just-ocaml/ property=og:url><meta content=https://mort.io/blog/just-ocaml/ name=twitter:url><meta content="...yes, I prefer `just` to `make` now" property=og:description><meta content="...yes, I prefer `just` to `make` now" name=twitter:description><meta content="`just` OCaml | mort’s mythopœia" property=og:title><meta content="`just` OCaml | mort’s mythopœia" name=twitter:title><meta content=summary name=twitter:card><meta content="mort’s mythopœia" property=og:site_name><meta content=en_US property=og:locale><meta content=website property=og:type><meta content=2025-02-07 property=og:updated_time><noscript><link href=https://mort.io/nojs.css rel=stylesheet></noscript><body><header><nav><div><big><a title="mort’s mythopœia" href=https://mort.io>mort’s mythopœia</a></big></div><div><div><ul><li><a class=s110 href=https://mort.io/research/> research </a><li><a class=s110 href=https://mort.io/students/> students </a><li><a class=s110 href=https://mort.io/teaching/> teaching </a><li><a class=s110 href=https://mort.io/codes/> codes </a><li><a class=s110 href=https://mort.io/me/> me </a></ul></div><div></div></div></nav><div class=desc>with apologies</div><hr></header><main><article><h1><a href=https://mort.io/blog/just-ocaml/><code>just</code> OCaml</a></h1><span class=s95><span class=hpad> ·</span> 2 min read<span class=hpad> ·</span> February 07, 2025<span class=hpad> ·</span> #<a href=https://mort.io/tags/tech/>tech</a> #<a href=https://mort.io/tags/code/>code</a> #<a href=https://mort.io/tags/ocaml/>ocaml</a> </span><nav><div><a href=https://mort.io/blog/internalcl-wifi/>‹ <code>nmcli</code> connection to internal WiFi</a></div><div><a href=https://mort.io/blog/reverse-find/> Reverse <code>find</code> ›</a></div></nav><p>In similar vein to a <a href=/blog/just-latex>recent post</a>, I have also started using <a href=https://just.systems/><code>just</code></a> when I periodically need to rebuild my <a href=https://ocaml.org/>OCaml</a> tool<sup class=footnote-reference><a href=#1>1</a></sup> <a href=https://github.com/mor1/ocal><code>ocal</code></a>. So I ended up replacing the old <a href=https://github.com/mor1/ocal/blob/6bb129627f9d1f27ab31cee810013b362ab80067/Makefile><code>Makefile</code></a> with a shiny new <a href=https://github.com/mor1/ocal/blob/8ef8631ae5bbe0315e359d725d467e7d0403fd31/Justfile><code>Justfile</code></a>.<p>As it also proved useful in another (more esoteric) tool I wrote <a href=https://github.com/mor1/cst-tools>for parsing out exam results for my students so I can paste into email easily</a>, I thought I’d put it here for the record. So here it is…<div class=footnote-definition id=1><sup class=footnote-definition-label>1</sup><p>Largely due to <a href=https://nixos.org/>NixOS</a> upgrades moving tools into different locations.</div><p>Usual preamble of course:<pre class="language-just z-code" data-lang=just><code class=language-just data-lang=just><span class="z-source z-just"><span class="z-meta z-function z-just"><span class="z-entity z-name z-function z-just">_default</span></span>:
</span><span class="z-source z-just">    <span class="z-storage z-modifier z-quiet z-just">@</span>just --list
</span></code></pre><p>Then set some common variables:<pre class="language-just z-code" data-lang=just><code class=language-just data-lang=just><span class="z-source z-just"><span class="z-variable z-other z-just">PWD</span> <span class="z-keyword z-operator z-assignment z-just">:=</span> <span class="z-source z-just">env</span><span class="z-invalid z-illegal z-just">(</span><span class="z-string z-quoted z-double z-just"><span class="z-punctuation z-definition z-string z-begin z-just">"</span>PWD<span class="z-punctuation z-definition z-string z-end z-just">"</span></span>)
</span><span class="z-source z-just"><span class="z-variable z-other z-just">DOCDIR</span> <span class="z-keyword z-operator z-assignment z-just">:=</span> <span class="z-string z-quoted z-double z-just"><span class="z-punctuation z-definition z-string z-begin z-just">"</span>_build/default/_doc/_html<span class="z-punctuation z-definition z-string z-end z-just">"</span></span>
</span><span class="z-source z-just"><span class="z-variable z-other z-just">BUILDDIR</span> <span class="z-keyword z-operator z-assignment z-just">:=</span> <span class="z-string z-quoted z-double z-just"><span class="z-punctuation z-definition z-string z-begin z-just">"</span>_build/install/default/bin<span class="z-punctuation z-definition z-string z-end z-just">"</span></span>
</span></code></pre><p>Then set the target — the tool name, in this case <code>ocal</code> (so named as this is an OCaml re-implementation of a tool approximating the trad Unix <a href=https://en.wikipedia.org/wiki/Cal_(command)><code>cal</code></a> tool):<pre class="language-just z-code" data-lang=just><code class=language-just data-lang=just><span class="z-source z-just"><span class="z-variable z-other z-just">TARGET</span> <span class="z-keyword z-operator z-assignment z-just">:=</span> <span class="z-string z-quoted z-double z-just"><span class="z-punctuation z-definition z-string z-begin z-just">"</span>ocal<span class="z-punctuation z-definition z-string z-end z-just">"</span></span>
</span></code></pre><p>Now for the actually useful stuff: some targets. Mostly these just call out to <code>dune</code> but in a way I find more intuitive.<pre class="language-just z-code" data-lang=just><code class=language-just data-lang=just><span class="z-source z-just"><span class="z-comment z-line z-number-sign z-just"><span class="z-punctuation z-definition z-comment z-begin z-just"># </span>build targets</span>
</span><span class="z-source z-just"><span class="z-meta z-function z-just"><span class="z-entity z-name z-function z-just">build</span></span>:
</span><span class="z-source z-just">    dune build @all
</span><span class="z-source z-just">
</span><span class="z-source z-just"><span class="z-comment z-line z-number-sign z-just"><span class="z-punctuation z-definition z-comment z-begin z-just"># </span>cleanup</span>
</span><span class="z-source z-just"><span class="z-meta z-function z-just"><span class="z-entity z-name z-function z-just">clean</span></span>:
</span><span class="z-source z-just">    dune clean
</span><span class="z-source z-just">
</span><span class="z-source z-just"><span class="z-comment z-line z-number-sign z-just"><span class="z-punctuation z-definition z-comment z-begin z-just"># </span>uninstall targets</span>
</span><span class="z-source z-just"><span class="z-meta z-function z-just"><span class="z-entity z-name z-function z-just">uninstall</span></span>:
</span><span class="z-source z-just">    dune uninstall
</span><span class="z-source z-just">
</span><span class="z-source z-just"><span class="z-comment z-line z-number-sign z-just"><span class="z-punctuation z-definition z-comment z-begin z-just"># </span>run any tests</span>
</span><span class="z-source z-just"><span class="z-meta z-function z-just"><span class="z-entity z-name z-function z-just">test</span></span>:
</span><span class="z-source z-just">    dune runtest
</span><span class="z-source z-just">
</span><span class="z-source z-just"><span class="z-comment z-line z-number-sign z-just"><span class="z-punctuation z-definition z-comment z-begin z-just"># </span>format sources</span>
</span><span class="z-source z-just"><span class="z-meta z-function z-just"><span class="z-entity z-name z-function z-just">format</span></span>:
</span><span class="z-source z-just">    dune fmt
</span></code></pre><p>Some compound calls next.<p>First, before building we might need to install dependencies, so do so in the time-honoured fashion:<pre class="language-just z-code" data-lang=just><code class=language-just data-lang=just><span class="z-source z-just"><span class="z-comment z-line z-number-sign z-just"><span class="z-punctuation z-definition z-comment z-begin z-just"># </span>install dependencies</span>
</span><span class="z-source z-just"><span class="z-meta z-function z-just"><span class="z-entity z-name z-function z-just">depends</span></span>:
</span><span class="z-source z-just">    opam install --yes dune-release odoc
</span><span class="z-source z-just">    opam install --yes . --deps-only
</span></code></pre><p>Next, to install I first build ready to install, then symlink the resulting binary into the right place in my home directory:<pre class="language-just z-code" data-lang=just><code class=language-just data-lang=just><span class="z-source z-just"><span class="z-comment z-line z-number-sign z-just"><span class="z-punctuation z-definition z-comment z-begin z-just"># </span>install targets</span>
</span><span class="z-source z-just"><span class="z-meta z-function z-just"><span class="z-entity z-name z-function z-just">install</span></span>: build
</span><span class="z-source z-just">    dune build @install
</span><span class="z-source z-just">    ln -sf <span class="z-meta z-interpolation z-just"><span class="z-punctuation z-section z-interpolation z-begin z-just">{{</span><span class="z-variable z-other z-just">PWD</span><span class="z-punctuation z-section z-interpolation z-end z-just">}}</span></span>/<span class="z-meta z-interpolation z-just"><span class="z-punctuation z-section z-interpolation z-begin z-just">{{</span><span class="z-variable z-other z-just">BUILDDIR</span><span class="z-punctuation z-section z-interpolation z-end z-just">}}</span></span>/<span class="z-meta z-interpolation z-just"><span class="z-punctuation z-section z-interpolation z-begin z-just">{{</span><span class="z-variable z-other z-just">TARGET</span><span class="z-punctuation z-section z-interpolation z-end z-just">}}</span></span> ~/.local/bin/
</span></code></pre><p>To lint all the things, invoke <code>dune</code> twice:<pre class="language-just z-code" data-lang=just><code class=language-just data-lang=just><span class="z-source z-just"><span class="z-comment z-line z-number-sign z-just"><span class="z-punctuation z-definition z-comment z-begin z-just"># </span>lint everything</span>
</span><span class="z-source z-just"><span class="z-meta z-function z-just"><span class="z-entity z-name z-function z-just">lint</span></span>:
</span><span class="z-source z-just">    dune build @lint
</span><span class="z-source z-just">    dune-release lint
</span></code></pre><p>Similarly, to build the docs, build <em>all</em> the docs:<pre class="language-just z-code" data-lang=just><code class=language-just data-lang=just><span class="z-source z-just"><span class="z-comment z-line z-number-sign z-just"><span class="z-punctuation z-definition z-comment z-begin z-just"># </span>build docs</span>
</span><span class="z-source z-just"><span class="z-meta z-function z-just"><span class="z-entity z-name z-function z-just">doc</span></span>:
</span><span class="z-source z-just">    dune build @doc
</span><span class="z-source z-just">    dune build @doc-private
</span></code></pre><p>Try to open the docs on Linux and if that fails, on MacOS:<pre class="language-just z-code" data-lang=just><code class=language-just data-lang=just><span class="z-source z-just"><span class="z-comment z-line z-number-sign z-just"><span class="z-punctuation z-definition z-comment z-begin z-just"># </span>open the docs for reading</span>
</span><span class="z-source z-just"><span class="z-meta z-function z-just"><span class="z-entity z-name z-function z-just">read</span></span>: doc
</span><span class="z-source z-just">    handlr open <span class="z-meta z-interpolation z-just"><span class="z-punctuation z-section z-interpolation z-begin z-just">{{</span><span class="z-variable z-other z-just">DOCDIR</span><span class="z-punctuation z-section z-interpolation z-end z-just">}}</span></span>/index.html || open <span class="z-meta z-interpolation z-just"><span class="z-punctuation z-section z-interpolation z-begin z-just">{{</span><span class="z-variable z-other z-just">DOCDIR</span><span class="z-punctuation z-section z-interpolation z-end z-just">}}</span></span>
</span></code></pre><p>Finally, tag and create a release; not actually done this in ages so no idea if <code>dune-release</code> invocations are still a thing, let alone correct!<pre class="language-just z-code" data-lang=just><code class=language-just data-lang=just><span class="z-source z-just"><span class="z-comment z-line z-number-sign z-just"><span class="z-punctuation z-definition z-comment z-begin z-just"># </span>tag and create a release</span>
</span><span class="z-source z-just"><span class="z-meta z-function z-just"><span class="z-entity z-name z-function z-just">release</span></span>:
</span><span class="z-source z-just">    dune-release tag
</span><span class="z-source z-just">    dune-release -vv
</span></code></pre><nav><div><a href=https://mort.io/blog/internalcl-wifi/>‹ <code>nmcli</code> connection to internal WiFi</a></div><div><a href=https://mort.io/blog/reverse-find/> Reverse <code>find</code> ›</a></div></nav><aside class=updates><ul><li>2025-02-14: Tidied up and clarified text a bit</ul></aside></article></main><footer><hr><div class=c><nav class=tpad><div><a title="mort’s mythopœia Atom Feed" href=https://mort.io/atom.xml target=_blank type=application/atom+xml><i class="svg rss" title="mort’s mythopœia Atom Feed" type=Button></i></a><a title="mort’s mythopœia RSS Feed" href=https://mort.io/rss.xml target=_blank type=application/rss+xml><i class="svg rss" title="mort’s mythopœia RSS Feed" type=Button></i></a><a href=mailto:richard.mortier@cl.cam.ac.uk target=_blank title=Mail><i class="svg mail" title=Mail type=Button></i></a><a href=https://mastodon.me.uk/@mort rel=me target=_blank title=Mastodon><i class="svg mastodon" title=Mastodon type=Button></i></a><a href=https://www.linkedin.com/in/richard-mortier/ target=_blank title=LinkedIn><i class="svg linkedin" title=LinkedIn type=Button></i></a><a href=https://github.com/mor1/ target=_blank title=Github><i class="svg github" title=Github type=Button></i></a><a href=https://hub.docker.com/u/mor1/ target=_blank title=Docker><i class="svg docker" title=Docker type=Button></i></a><a href="https://www.youtube.com/playlist?list=PLkRF0fgqvvMx5Owh1QgilmExGQe58go_u" target=_blank title=YouTube><i class="svg youtube" title=YouTube type=Button></i></a></div></nav><nav class=vpad><a class=rpad href=https://mort.io/sitemap.xml target=_blank> sitemap </a><a class=rpad href=https://mort.io/tags/> tags </a></nav><p class=s90>mort’s mythopœia © 2013—<span id=year>2025</span> Richard Mortier</div></footer>