<!doctype html><html lang=en><head><link href="https://mort.io/abridge.css?h=5f1494977bbccc1fddc1" rel=stylesheet><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1" name=viewport><meta content=https://mort.io name=base><meta content=True name=HandheldFriendly><meta content=yes name=mobile-web-app-capable><meta content=yes name=apple-mobile-web-app-capable><meta content=default name=apple-mobile-web-app-status-bar-style><link title="mort’s mythopœia Atom Feed" href=https://mort.io/atom.xml rel=alternate type=application/atom+xml><link title="mort’s mythopœia RSS Feed" href=https://mort.io/rss.xml rel=alternate type=application/rss+xml><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>Back to my Roots | mort’s mythopœia</title><meta content="mort’s mythopœia" name=copyright><meta content="Garbage cleaning all the things" name=description><link href=https://mort.io/blog/back-to-my-roots/ rel=canonical><meta content=https://mort.io/blog/back-to-my-roots/ property=og:url><meta content=https://mort.io/blog/back-to-my-roots/ name=twitter:url><meta content="Garbage cleaning all the things" property=og:description><meta content="Garbage cleaning all the things" name=twitter:description><meta content="Back to my Roots | mort’s mythopœia" property=og:title><meta content="Back to my Roots | mort’s mythopœia" name=twitter:title><meta content=summary name=twitter:card><meta content="mort’s mythopœia" property=og:site_name><meta content=en_US property=og:locale><meta content=website property=og:type><meta content=2025-11-05 property=og:updated_time><noscript><link href=https://mort.io/nojs.css rel=stylesheet></noscript><body><header><nav><div><big><a title="mort’s mythopœia" href=https://mort.io>mort’s mythopœia</a></big></div><div><div><ul><li><a class=s110 href=https://mort.io/research/> research </a><li><a class=s110 href=https://mort.io/students/> students </a><li><a class=s110 href=https://mort.io/teaching/> teaching </a><li><a class=s110 href=https://mort.io/codes/> codes </a><li><a class=s110 href=https://mort.io/me/> me </a></ul></div><div></div></div></nav><div class=desc>with apologies</div><hr></header><main><article><h1><a href=https://mort.io/blog/back-to-my-roots/>Back to my Roots</a></h1><span class=s95><span class=hpad> ·</span> 2 min read<span class=hpad> ·</span> November 05, 2025<span class=hpad> ·</span> #<a href=https://mort.io/tags/nixos/>nixos</a> #<a href=https://mort.io/tags/tech/>tech</a> #<a href=https://mort.io/tags/config/>config</a> </span><nav><div><a href=https://mort.io/blog/sabbatical-diary-w5/>‹ Sabbatical Diary: Week 5</a></div><div><a href=https://mort.io/blog/sabbatical-diary-w4/> Sabbatical Diary: Week 4 / Month 1 ›</a></div></nav><p>This is another one of those that’s largely documenting something for myself, but I’m sharing it in case others find it useful. And because self-aggrandisement is what it’s all about these days amirite?<p>I recently had issues because my NixOS installation ran out of space in the root partition wherein lies <code>/nix/store/</code>, the read-only filesystem containing the Nix store. It’s a pain when this runs out of space because then upgrading gets tricky—due to rollback support, there’s a general tendency to need enough space for at least all the new stuff in the new version <em>in addition</em> to the old versions.<p>I’d done all the usual garbage collection to try to free up as much space as possible—but still not enough free. What to do? This had used to work so I figured it was probably something to do with some content that should be being garbage collected but wasn’t—I’ve had that problem before when playing around with flakes. Some searching around showed that the solution was actually relatively straightforward.<p>First, find the roots – these are linked in <code>/nix/var/nix/gcroots</code> – then resolve them and use <code>nix path-info --closure-size</code> to list all the closures with their real sizes. Something like:<pre class=giallo style=color:#839496;background-color:#002b36><code data-lang=shellscript><span class=giallo-l><span style=color:#586e75;font-style:italic>#!/usr/bin/env bash</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#859900>for</span><span style=color:#268bd2> link</span><span style=color:#859900> in</span><span> $(</span><span style=color:#268bd2>find</span><span style=color:#2aa198> /nix/var/nix/gcroots</span><span style=color:#cb4b16> -type</span><span style=color:#2aa198> l</span><span style=color:#cb4b16> -readable</span><span>);</span><span style=color:#859900> do</span></span>
<span class=giallo-l><span style=color:#268bd2>  res</span><span style=color:#859900>=</span><span style=color:#2aa198>"</span><span style=color:#859900>${</span><span style=color:#268bd2>res</span><span style=color:#859900>}</span></span>
<span class=giallo-l><span style=color:#2aa198>$(</span><span style=color:#268bd2>readlink</span><span style=color:#2aa198> "</span><span style=color:#859900>${</span><span style=color:#268bd2>link</span><span style=color:#859900>}</span><span style=color:#2aa198>") $(</span><span style=color:#268bd2>nix</span><span style=color:#2aa198> path-info</span><span style=color:#cb4b16> --closure-size -sh</span><span style=color:#2aa198> "</span><span style=color:#859900>${</span><span style=color:#268bd2>link</span><span style=color:#859900>}</span><span style=color:#2aa198>")"</span></span>
<span class=giallo-l><span style=color:#859900>done</span></span>
<span class=giallo-l><span style=color:#268bd2>echo</span><span style=color:#2aa198> "</span><span style=color:#268bd2>$res</span><span style=color:#2aa198>"</span><span style=color:#859900> |</span><span style=color:#268bd2> sort</span><span style=color:#cb4b16> -h -k3,3</span></span></code></pre><p>This gave me the following (line numbers added after the fact):<pre class=giallo style=color:#839496;background-color:#002b36><code data-lang=shellscript><span class=giallo-l><span aria-hidden=true class=giallo-ln>1</span><span style=color:#268bd2>/nix/var/nix/profiles/default-1-link</span><span style=color:#2aa198> /nix/store/57904rflsfh46y7fxi62rzc7sidc9vmq-user-environment</span><span style=color:#d33682>	   0.3</span><span style=color:#2aa198> KiB</span><span style=color:#d33682>	   0.5</span><span style=color:#2aa198> KiB</span></span>
<span class=giallo-l><span aria-hidden=true class=giallo-ln>2</span><span style=color:#268bd2>/nix/var/nix/profiles/per-user/mort/channels-2-link</span><span style=color:#2aa198> /nix/store/57904rflsfh46y7fxi62rzc7sidc9vmq-user-environment</span><span style=color:#d33682>	   0.3</span><span style=color:#2aa198> KiB</span><span style=color:#d33682>	   0.5</span><span style=color:#2aa198> KiB</span></span>
<span class=giallo-l><span aria-hidden=true class=giallo-ln>3</span><span style=color:#268bd2>/nix/var/nix/profiles/per-user/root/channels-117-link</span><span style=color:#2aa198> /nix/store/fnlgy7im4rcd4ssh8xxy0kcr3aac7paf-user-environment</span><span style=color:#d33682>	   0.8</span><span style=color:#2aa198> KiB</span><span style=color:#d33682>	 394.1</span><span style=color:#2aa198> MiB</span></span>
<span class=giallo-l><span aria-hidden=true class=giallo-ln>4</span><span style=color:#268bd2>/home/mort/.cache/nix/flake-registry.json</span><span style=color:#2aa198> /nix/store/pc6y12ccrlvmgfbp0rs34cbj8mbsyyvk-flake-registry.json</span><span style=color:#d33682>	   7.3</span><span style=color:#2aa198> KiB</span><span style=color:#d33682>	   7.3</span><span style=color:#2aa198> KiB</span></span>
<span class=giallo-l><span aria-hidden=true class=giallo-ln>5</span><span style=color:#268bd2>/home/mort/.local/state/nix/profiles/home-manager-425-link</span><span style=color:#2aa198> /nix/store/p8y1zr968ajjnva0whznygvqv09fvdd2-home-manager-generation</span><span style=color:#d33682>	  17.5</span><span style=color:#2aa198> KiB</span><span style=color:#d33682>	  14.1</span><span style=color:#2aa198> GiB</span></span>
<span class=giallo-l><span aria-hidden=true class=giallo-ln>6</span><span style=color:#268bd2>/home/mort/.local/state/home-manager/gcroots/current-home</span><span style=color:#2aa198> /nix/store/kmb5w2qymnnhqv3wz3k1nw0psp2qqgmx-home-manager-generation</span><span style=color:#d33682>	  17.6</span><span style=color:#2aa198> KiB</span><span style=color:#d33682>	   3.0</span><span style=color:#2aa198> GiB</span></span>
<span class=giallo-l><span aria-hidden=true class=giallo-ln>7</span><span style=color:#268bd2>/nix/var/nix/profiles/system-931-link</span><span style=color:#2aa198> /nix/store/sinifrppd8m6kah30wywc27adyzqhgzy-nixos-system-greyjay-25.11.20251028.08dacfc</span><span style=color:#d33682>	  18.5</span><span style=color:#2aa198> KiB</span><span style=color:#d33682>	   8.4</span><span style=color:#2aa198> GiB</span></span>
<span class=giallo-l><span aria-hidden=true class=giallo-ln>8</span><span style=color:#268bd2>/run/booted-system</span><span style=color:#2aa198> /nix/store/sinifrppd8m6kah30wywc27adyzqhgzy-nixos-system-greyjay-25.11.20251028.08dacfc</span><span style=color:#d33682>	  18.5</span><span style=color:#2aa198> KiB</span><span style=color:#d33682>	   8.4</span><span style=color:#2aa198> GiB</span></span>
<span class=giallo-l><span aria-hidden=true class=giallo-ln>9</span><span style=color:#268bd2>/run/current-system</span><span style=color:#2aa198> /nix/store/sinifrppd8m6kah30wywc27adyzqhgzy-nixos-system-greyjay-25.11.20251028.08dacfc</span><span style=color:#d33682>	  18.5</span><span style=color:#2aa198> KiB</span><span style=color:#d33682>	   8.4</span><span style=color:#2aa198> GiB</span></span>
<span class=giallo-l><span aria-hidden=true class=giallo-ln>10</span><span style=color:#268bd2>/nix/var/nix/profiles/per-user/mort/profile-1167-link</span><span style=color:#2aa198> /nix/store/6fc897c236g7yjpz467plxmzp5ycx87w-profile</span><span style=color:#d33682>	  66.0</span><span style=color:#2aa198> KiB</span><span style=color:#d33682>	   3.0</span><span style=color:#2aa198> GiB</span></span></code></pre><p>The first three lines under <code>/nix/var/nix/profiles</code> are small and channel-state related; the fourth is also tiny and something flake-related. Lines 8 and 9 beginning <code>/run/</code> are the currently running system so leave them alone; the match of the underlying path with that of line 7 shows that 931 is the currently running generation.<p>However, lines 5 and 6 are suspicious:<pre class=giallo style=color:#839496;background-color:#002b36><code data-lang=shellscript><span class=giallo-l><span aria-hidden=true class=giallo-ln>5</span><span style=color:#268bd2>/home/mort/.local/state/nix/profiles/home-manager-425-link</span><span style=color:#2aa198> /nix/store/p8y1zr968ajjnva0whznygvqv09fvdd2-home-manager-generation</span><span style=color:#d33682>	  17.5</span><span style=color:#2aa198> KiB</span><span style=color:#d33682>	  14.1</span><span style=color:#2aa198> GiB</span></span>
<span class=giallo-l><span aria-hidden=true class=giallo-ln>6</span><span style=color:#268bd2>/home/mort/.local/state/home-manager/gcroots/current-home</span><span style=color:#2aa198> /nix/store/kmb5w2qymnnhqv3wz3k1nw0psp2qqgmx-home-manager-generation</span><span style=color:#d33682>	  17.6</span><span style=color:#2aa198> KiB</span><span style=color:#d33682>	   3.0</span><span style=color:#2aa198> GiB</span></span></code></pre><p>These look like dead roots from random rebuilds, tryouts, whatever. And the first one is big at over 14GiB. So just delete it and re-run garbage collection:<pre class=giallo style=color:#839496;background-color:#002b36><code data-lang=shellscript><span class=giallo-l><span style=color:#268bd2>rm</span><span style=color:#2aa198> ~/.local/state/nix/profiles/home-manager-425-link</span></span>
<span class=giallo-l><span style=color:#268bd2>sudo</span><span style=color:#2aa198> nix-store</span><span style=color:#cb4b16> --gc</span><span> &&</span><span style=color:#268bd2> nix-store</span><span style=color:#cb4b16> --gc</span></span>
<span class=giallo-l><span style=color:#268bd2>nixos-rebuild</span><span style=color:#cb4b16> --sudo</span><span style=color:#2aa198> switch</span></span></code></pre><p>Lo and behold! suddenly I have about 15GiB extra free. Happy days :)<p>In the end, I tweaked that script to the following (logically) one-liner; recorded here so I can copy’n’paste it again in future:<pre class=giallo style=color:#839496;background-color:#002b36><code data-lang=shellscript><span class=giallo-l><span style=color:#268bd2>fd</span><span style=color:#cb4b16> -t</span><span style=color:#2aa198> l . /nix/var/nix/gcroots</span><span style=color:#859900> |</span><span style=color:#268bd2> xargs</span><span style=color:#2aa198> readlink</span><span style=color:#859900> | while</span><span style=color:#268bd2> read</span><span style=color:#2aa198> link</span><span>;</span><span style=color:#859900> do</span></span>
<span class=giallo-l><span style=color:#268bd2>  printf</span><span style=color:#2aa198> "%s "</span><span style=color:#268bd2> $link</span></span>
<span class=giallo-l><span style=color:#268bd2>  test</span><span style=color:#cb4b16> -r</span><span style=color:#268bd2> $link</span><span> &&</span><span style=color:#268bd2> nix</span><span style=color:#2aa198> path-info</span><span style=color:#cb4b16> -Ssh</span><span style=color:#268bd2> $link</span></span>
<span class=giallo-l><span style=color:#859900>done |</span><span style=color:#268bd2> tr</span><span style=color:#cb4b16> -d</span><span style=color:#2aa198> " "</span><span style=color:#859900> |</span><span style=color:#268bd2> tr</span><span style=color:#2aa198> "\t" " "</span><span style=color:#859900> |</span><span style=color:#268bd2> tr</span><span style=color:#cb4b16> -s</span><span style=color:#2aa198> " "</span><span style=color:#859900> |</span><span style=color:#268bd2> sort</span><span style=color:#cb4b16> -h -t</span><span style=color:#2aa198>" "</span><span style=color:#cb4b16> -k3</span><span style=color:#859900> |</span><span style=color:#268bd2> uniq</span><span style=color:#859900> |</span><span style=color:#268bd2> tr</span><span style=color:#2aa198> " " "\t"</span></span></code></pre><nav><div><a href=https://mort.io/blog/sabbatical-diary-w5/>‹ Sabbatical Diary: Week 5</a></div><div><a href=https://mort.io/blog/sabbatical-diary-w4/> Sabbatical Diary: Week 4 / Month 1 ›</a></div></nav></article></main><footer><hr><div class=c><nav class=tpad><div><a title="mort’s mythopœia Atom Feed" href=https://mort.io/atom.xml target=_blank type=application/atom+xml><i class="svg rss" title="mort’s mythopœia Atom Feed" type=Button></i></a><a title="mort’s mythopœia RSS Feed" href=https://mort.io/rss.xml target=_blank type=application/rss+xml><i class="svg rss" title="mort’s mythopœia RSS Feed" type=Button></i></a><a href=mailto:richard.mortier@cl.cam.ac.uk target=_blank title=Mail><i class="svg mail" title=Mail type=Button></i></a><a href=https://mastodon.me.uk/@mort rel=me target=_blank title=Mastodon><i class="svg mastodon" title=Mastodon type=Button></i></a><a href=https://www.linkedin.com/in/richard-mortier/ target=_blank title=LinkedIn><i class="svg linkedin" title=LinkedIn type=Button></i></a><a href=https://github.com/mor1/ target=_blank title=Github><i class="svg github" title=Github type=Button></i></a><a href=https://hub.docker.com/u/mor1/ target=_blank title=Docker><i class="svg docker" title=Docker type=Button></i></a><a href="https://www.youtube.com/playlist?list=PLkRF0fgqvvMx5Owh1QgilmExGQe58go_u" target=_blank title=YouTube><i class="svg youtube" title=YouTube type=Button></i></a></div></nav><nav class=vpad><a class=rpad href=https://mort.io/sitemap.xml target=_blank> sitemap </a><a class=rpad href=https://mort.io/tags/> tags </a></nav><p class=s90>mort’s mythopœia © 2013—<span id=year>2026</span> Richard Mortier</div></footer>