<!doctype html><html lang=en><head><link href="https://mort.io/abridge.css?h=ef0df812e427238e124c" rel=stylesheet><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1" name=viewport><meta content=https://mort.io name=base><meta content=True name=HandheldFriendly><meta content=yes name=mobile-web-app-capable><meta content=yes name=apple-mobile-web-app-capable><meta content=default name=apple-mobile-web-app-status-bar-style><link title="mort’s mythopœia Atom Feed" href=https://mort.io/atom.xml rel=alternate type=application/atom+xml><link title="mort’s mythopœia RSS Feed" href=https://mort.io/rss.xml rel=alternate type=application/rss+xml><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>Building Up Your ARMs | mort’s mythopœia</title><meta content="mort’s mythopœia" name=copyright><meta content="Creating boot images for Cubieboards" name=description><link href=https://mort.io/blog/building-up-your-arms/ rel=canonical><meta content=https://mort.io/blog/building-up-your-arms/ property=og:url><meta content=https://mort.io/blog/building-up-your-arms/ name=twitter:url><meta content="Creating boot images for Cubieboards" property=og:description><meta content="Creating boot images for Cubieboards" name=twitter:description><meta content="Building Up Your ARMs | mort’s mythopœia" property=og:title><meta content="Building Up Your ARMs | mort’s mythopœia" name=twitter:title><meta content=summary name=twitter:card><meta content="mort’s mythopœia" property=og:site_name><meta content=en_US property=og:locale><meta content=website property=og:type><meta content=2016-11-16 property=og:updated_time><noscript><link href=https://mort.io/nojs.css rel=stylesheet></noscript><body><header><nav><div><big><a title="mort’s mythopœia" href=https://mort.io>mort’s mythopœia</a></big></div><div><div><ul><li><a class=s110 href=https://mort.io/research/> research </a><li><a class=s110 href=https://mort.io/students/> students </a><li><a class=s110 href=https://mort.io/teaching/> teaching </a><li><a class=s110 href=https://mort.io/codes/> codes </a><li><a class=s110 href=https://mort.io/me/> me </a></ul></div><div></div></div></nav><div class=desc>with apologies</div><hr></header><main><article><h1><a href=https://mort.io/blog/building-up-your-arms/>Building Up Your ARMs</a></h1><span class=s95><span class=hpad> ·</span> 3 min read<span class=hpad> ·</span> November 16, 2016<span class=hpad> ·</span> #<a href=https://mort.io/tags/tech/>tech</a> #<a href=https://mort.io/tags/linuxkit/>linuxkit</a> #<a href=https://mort.io/tags/arm64/>arm64</a> #<a href=https://mort.io/tags/docker/>docker</a> </span><nav><div><a href=https://mort.io/blog/brew-plist/>‹ Customising Homebrew service</a></div><div><a href=https://mort.io/blog/jquery-console/> Debugging with jQuery ›</a></div></nav><p>Due to the impending finish of the EU FP7 funded <a href=https://usercentricnetworking.eu>User Centric Networking</a><sup class=footnote-reference><a href=#1>1</a></sup> I recently had cause to revisit the excellent work that <a href=https://github.com/talex5>Thomas Leonard</a> did for the project in getting Xen/ARM running on the <a href=http://cubieboard.org/model/cb2/>Cubieboard2</a> and <a href=http://cubieboard.org/model/cb3/>Cubietruck</a> (aka <a href=http://cubieboard.org/model/cb3/>Cubieboard3</a>).<p>The resulting repo, <a href=https://github.com/mirage/xen-arm-builder>mirage/xen-arm-builder</a>, had languished for several months and the past SD card images had some problems and had been allowed to drop off the ’Net as a result. However, sterling work by <a href=https://github.com/ijc25>Ian Campbell</a> at a recent Mirage <a href=https://mirage.io/blog/2016-summer-hackathon-roundup>hackathon</a> had started to resurrect this work based on the <a href=https://alpinelinux.org/>Alpine Linux</a> distribution. This seemed a promising place to start, so I did :)<h2 id=building-an-image><a aria-label="Anchor link for: building-an-image" class=zola-anchor href=#building-an-image>Building an Image</a></h2><p>The end result was an enormous <a href=https://github.com/mirage/xen-arm-builder/pull/71>pull request</a> that splatted a Brave New World on top of <a href=https://github.com/talex5>Thomas’</a> work. The <a href=https://github.com/mirage/xen-arm-builder/blob/master/README.md><code>README</code></a> is hopefully reasonably self-explanatory but in summary,<ol><li><p>Clone the repo:</p> <pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">git</span></span><span class="z-meta z-function-call z-arguments z-shell"> clone https://github.com/mor1/arm-image-builder.git</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-cd z-shell">cd</span></span><span class="z-meta z-function-call z-arguments z-shell"> arm-image-builder</span>
</span></code></pre><li><p>Use the <code>make</code> targets:</p> <pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">make</span></span><span class="z-meta z-function-call z-arguments z-shell"> all       <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> runs `make prepare build image`</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> make prepare # clones repos, pulls tarballs</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> make build   # use Docker to build the `linux/` and `u-boot/` trees</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> make image   # finally, create the on-disk `sdcard.img`</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></code></pre></ol><p>This clones the necessary repos (Linux, u-boot), builds them, and then puts together the image file <code>sdcard.img</code> in the current directory. If on OSX, <code>make sdcard</code> will then attempt to write that to a blank, mounted SD card. This does a rather hacky auto-discovery of where the SD card might be mounted; if in doubt, and in any case, always safer to simply<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">MNT</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">the-correct-mount-point</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">make</span></span><span class="z-meta z-function-call z-arguments z-shell"> sdcard</span>
</span></code></pre><p>…or simply use your favourite tools to write the <code>sdcard.img</code> file to your SD card.<h2 id=using-the-image><a aria-label="Anchor link for: using-the-image" class=zola-anchor href=#using-the-image>Using the Image</a></h2><p>The end result should be an SD card that you can use to boot your device into <a href=https://alpinelinux.org/>Alpine Linux v3.4</a>. At present, completing installation requires then:<ul><li><a href=https://github.com/mirage/xen-arm-builder#first-boot--re-initialisation>resetting the environment</a>,<li><a href=https://github.com/mirage/xen-arm-builder#base-install>completing Alpine setup</a> via the <code>setup-alpine</code> script,<li>(if desired) installing Xen via the <code>/media/mmcblk0p1/alpine-dom0-install.sh</code> script created as part of building the SD card image,<li>(if desired) finally, building <a href=https://github.com/mirage/xen-arm-builder#alpine>Alpine</a> and/or <a href=https://github.com/mirage/xen-arm-builder#debian>Debian</a> <code>domU</code>s via the <code>/media/mmcblk0p1/alpine-domU-install.sh</code> and <code>/media/mmcblk0p1/debian-domU-install.sh</code> scripts, also created as part of building the image.</ul><p>Hopefully the net result is you end up with a Cubieboard2/3 running Xen with an Alpine Linux <code>dom0</code> and some <code>domU</code> images available.<p>As ever, <a href=https://twitter.com/mort___>comments, patches, pull requests welcome</a>!<div class=footnote-definition id=1><sup class=footnote-definition-label>1</sup><p>Grant No. 611001 for those who care.</div><nav><div><a href=https://mort.io/blog/brew-plist/>‹ Customising Homebrew service</a></div><div><a href=https://mort.io/blog/jquery-console/> Debugging with jQuery ›</a></div></nav></article></main><footer><hr><div class=c><nav class=tpad><div><a title="mort’s mythopœia Atom Feed" href=https://mort.io/atom.xml target=_blank type=application/atom+xml><i class="svg rss" title="mort’s mythopœia Atom Feed" type=Button></i></a><a title="mort’s mythopœia RSS Feed" href=https://mort.io/rss.xml target=_blank type=application/rss+xml><i class="svg rss" title="mort’s mythopœia RSS Feed" type=Button></i></a><a href=mailto:richard.mortier@cl.cam.ac.uk target=_blank title=Mail><i class="svg mail" title=Mail type=Button></i></a><a href=https://mastodon.me.uk/@mort rel=me target=_blank title=Mastodon><i class="svg mastodon" title=Mastodon type=Button></i></a><a href=https://www.linkedin.com/in/richard-mortier/ target=_blank title=LinkedIn><i class="svg linkedin" title=LinkedIn type=Button></i></a><a href=https://github.com/mor1/ target=_blank title=Github><i class="svg github" title=Github type=Button></i></a><a href=https://hub.docker.com/u/mor1/ target=_blank title=Docker><i class="svg docker" title=Docker type=Button></i></a><a href="https://www.youtube.com/playlist?list=PLkRF0fgqvvMx5Owh1QgilmExGQe58go_u" target=_blank title=YouTube><i class="svg youtube" title=YouTube type=Button></i></a></div></nav><nav class=vpad><a class=rpad href=https://mort.io/sitemap.xml target=_blank> sitemap </a><a class=rpad href=https://mort.io/tags/> tags </a></nav><p class=s90>mort’s mythopœia © 2013—<span id=year>2025</span> Richard Mortier</div></footer><span class=topout> <span class=topleft> </span><a title="Back to Top" class=top href=#><i class="svgs svgh angu"></i></a> </span>