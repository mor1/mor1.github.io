<!doctype html><html lang=en><head><link href="https://mort.io/abridge.css?h=5f1494977bbccc1fddc1" rel=stylesheet><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1" name=viewport><meta content=https://mort.io name=base><meta content=True name=HandheldFriendly><meta content=yes name=mobile-web-app-capable><meta content=yes name=apple-mobile-web-app-capable><meta content=default name=apple-mobile-web-app-status-bar-style><link title="mort’s mythopœia Atom Feed" href=https://mort.io/atom.xml rel=alternate type=application/atom+xml><link title="mort’s mythopœia RSS Feed" href=https://mort.io/rss.xml rel=alternate type=application/rss+xml><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>Of Mice and Keyboards | mort’s mythopœia</title><meta content="mort’s mythopœia" name=copyright><meta content="El Capitan Upgrade and Microsoft Devices" name=description><link href=https://mort.io/blog/elcapitan-maps/ rel=canonical><meta content=https://mort.io/blog/elcapitan-maps/ property=og:url><meta content=https://mort.io/blog/elcapitan-maps/ name=twitter:url><meta content="El Capitan Upgrade and Microsoft Devices" property=og:description><meta content="El Capitan Upgrade and Microsoft Devices" name=twitter:description><meta content="Of Mice and Keyboards | mort’s mythopœia" property=og:title><meta content="Of Mice and Keyboards | mort’s mythopœia" name=twitter:title><meta content=summary name=twitter:card><meta content="mort’s mythopœia" property=og:site_name><meta content=en_US property=og:locale><meta content=website property=og:type><meta content=2015-11-21 property=og:updated_time><noscript><link href=https://mort.io/nojs.css rel=stylesheet></noscript><body><header><nav><div><big><a title="mort’s mythopœia" href=https://mort.io>mort’s mythopœia</a></big></div><div><div><ul><li><a class=s110 href=https://mort.io/research/> research </a><li><a class=s110 href=https://mort.io/students/> students </a><li><a class=s110 href=https://mort.io/teaching/> teaching </a><li><a class=s110 href=https://mort.io/codes/> codes </a><li><a class=s110 href=https://mort.io/me/> me </a></ul></div><div></div></div></nav><div class=desc>with apologies</div><hr></header><main><article><h1><a href=https://mort.io/blog/elcapitan-maps/>Of Mice and Keyboards</a></h1><span class=s95><span class=hpad> ·</span> 4 min read<span class=hpad> ·</span> November 21, 2015<span class=hpad> ·</span> #<a href=https://mort.io/tags/tech/>tech</a> #<a href=https://mort.io/tags/config/>config</a> #<a href=https://mort.io/tags/dotfiles/>dotfiles</a> </span><aside class=updates><ul><li>2025-05-29: Fixed broken image links</ul></aside><nav><div><a href=https://mort.io/blog/local-knowledge/>‹ Local Knowledge</a></div><div><a href=https://mort.io/blog/bigtechday-mirage/> Fame and Fortune! ›</a></div></nav><p>A bit of a delay since the last post – lots going on! But anyway: I (relatively) recently upgraded my old skool Macbook Pro (look! built-in Ethernet port! DVD drive!) to El Capitan. This was generally rather less faff that the previous upgrade, though it did seem to take rather more reboots than might have been assumed to be <em>strictly</em> necessary before it settled down, and I’d remembered to fix up permissions for Homebrew with <code>sudo chown -R $(whoami):admin /usr/local</code>. So that was ok.<p><img alt="Macbook Pro UK Keyboard" title="Macbook Pro
UK Keyboard" src=https://mort.io/blog/elcapitan-maps/keyboard-small.png><p>Except… I have a slightly odd keyboard and mouse setup. It’s a UK Macbook which means a slightly tweaked keyboard layout compared to the standard US Macbook keyboard. At my desk, I also use a <em>Microsoft Digital Media Keyboard</em> – nice action (for me!) plus some handy shortcut keys – and a <em>Microsoft 5-Button Mouse with IntelliEye</em>. Now, until El Capitan I’d happily been using the Microsoft provided software to make use of the extra mouse buttons and shortcut keys, coupled with a <a href="http://scripts.sil.org/cms/scripts/page.php?site_id=nrsi&id=ukelele" rel=external>Ukelele-generated</a> keymap to handle the oddities of the UK laptop keyboard (like, who in the world really needs <code>§</code> at the top-left key, below <code>escape</code> rather than <code>`</code>; and doesn’t need an easily accessible <code>#</code>?).<p>This had never been entirely satisfactory – I had to have a standard keymap installed in addition to my modified one, and some apps (all of Microsoft Office, I’m looking at you) liked to intermittently flip the keymap away from my keymap to the standard issue on, including undoing my remapping of <code>caps lock</code> to <code>ctrl</code>. This was annoying, but having it completely break was intolerable.<p>So I went hunting for alternatives and am now very happy with <a href=https://pqrs.org/osx/karabiner/ rel=external>Karabiner.app</a> for standard keyboard remappings, and fairly happy with <a href=http://www.usboverdrive.com rel=external>USB Overdrive</a> to handle the mouse and the special Microsoft Digital Media Keyboard shortcut keys.<h3 id=usb-overdrive><a aria-label="Anchor link for: usb-overdrive" class=zola-anchor href=#usb-overdrive>USB Overdrive</a></h3><p>USB Overdrive seems to do the mouse mappings correctly, having detected the device as a “Microsoft 5-Button Mouse with IntelliEye(tm), Any Application” – <code>Button 4</code> and <code>Button 5</code> can be remapped to <code>forward</code> and <code>back</code>, just as I like it.<p><img alt="USB Overdrive" title="USB Overdrive Configuration" src=https://mort.io/blog/elcapitan-maps/usboverdrive.png><p>It also allows me to repurpose some of the extra keys on my Microsoft keyboard that <a href=https://pqrs.org/osx/karabiner/ rel=external>Karabiner</a> doesn’t seem able to see– so I get one touch play/pause of iTunes and other such delights.<h3 id=karabiner-app><a aria-label="Anchor link for: karabiner-app" class=zola-anchor href=#karabiner-app>Karabiner.app</a></h3><p><a href=https://pqrs.org/osx/karabiner/ rel=external>Karabiner</a> took a bit more setting up but does a very nice job. I needed to remap certain keys differently on the two different keyboards to make both consistent and to fix some of the weirder (to my mind!) decisions both Microsoft and (particualrly) Apple have taken with their layouts. The result is an <a href=https://github.com/mor1/rc-files/blob/master/karabiner.xml rel=external>XML configuration file</a>, symlinked by <code>~/Library/Application Support/Karabiner/private.xml</code>. This applies two keymaps based on the detected device, using product ID codes determined by the <code>EventViewer</code> app that comes with <a href=https://pqrs.org/osx/karabiner/ rel=external>Karabiner</a>:<pre class=giallo style=color:#839496;background-color:#002b36><code data-lang=xml><span class=giallo-l><span style=color:#586e75>&lt;</span><span style=color:#268bd2>deviceproductdef</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span style=color:#586e75>  &lt;</span><span style=color:#268bd2>productname</span><span style=color:#586e75>></span><span>MACBOOK_PRO_UK_KEYBOARD</span><span style=color:#586e75>&lt;/</span><span style=color:#268bd2>productname</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span style=color:#586e75>  &lt;</span><span style=color:#268bd2>productid</span><span style=color:#586e75>></span><span>0x0253</span><span style=color:#586e75>&lt;/</span><span style=color:#268bd2>productid</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span style=color:#586e75>&lt;/</span><span style=color:#268bd2>deviceproductdef</span><span style=color:#586e75>></span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#586e75>&lt;</span><span style=color:#268bd2>deviceproductdef</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span style=color:#586e75>  &lt;</span><span style=color:#268bd2>productname</span><span style=color:#586e75>></span><span>DIGITAL_MEDIA_KEYBOARD</span><span style=color:#586e75>&lt;/</span><span style=color:#268bd2>productname</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span style=color:#586e75>  &lt;</span><span style=color:#268bd2>productid</span><span style=color:#586e75>></span><span>0x00b4</span><span style=color:#586e75>&lt;/</span><span style=color:#268bd2>productid</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span style=color:#586e75>&lt;/</span><span style=color:#268bd2>deviceproductdef</span><span style=color:#586e75>></span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#586e75>&lt;</span><span style=color:#268bd2>deviceproductdef</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span style=color:#586e75>  &lt;</span><span style=color:#268bd2>productname</span><span style=color:#586e75>></span><span>FIVE_BUTTON_MOUSE_WITH_INTELLIEYE</span><span style=color:#586e75>&lt;/</span><span style=color:#268bd2>productname</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span style=color:#586e75>  &lt;</span><span style=color:#268bd2>productid</span><span style=color:#586e75>></span><span>0x0039</span><span style=color:#586e75>&lt;/</span><span style=color:#268bd2>productid</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span style=color:#586e75>&lt;/</span><span style=color:#268bd2>deviceproductdef</span><span style=color:#586e75>></span></span></code></pre><p>There are then two <code>&lt;item>&lt;/item></code> stanzas that configure the two different keyboards, e.g.,<pre class=giallo style=color:#839496;background-color:#002b36><code data-lang=xml><span class=giallo-l><span style=color:#586e75>&lt;</span><span style=color:#268bd2>item</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span style=color:#586e75>  &lt;</span><span style=color:#268bd2>name</span><span style=color:#586e75>></span><span>Keyboard mappings for Microsoft keyboard</span><span style=color:#586e75>&lt;/</span><span style=color:#268bd2>name</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span style=color:#586e75>  &lt;</span><span style=color:#268bd2>identifier</span><span style=color:#586e75>></span><span>private.io.mort.microsoft_keyboard</span><span style=color:#586e75>&lt;/</span><span style=color:#268bd2>identifier</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span style=color:#586e75>  &lt;</span><span style=color:#268bd2>device_only</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span>    DeviceVendor::MICROSOFT,</span></span>
<span class=giallo-l><span>    DeviceProduct::DIGITAL_MEDIA_KEYBOARD</span></span>
<span class=giallo-l><span style=color:#586e75>  &lt;/</span><span style=color:#268bd2>device</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span>  ...</span></span></code></pre><p>Each of these contains a number of <code>&lt;autogen>&lt;/autogen></code> stanza mapping specific keycodes for that keymap. For example, I want the top-left key on the main block to be <code>`</code> and, when shifted, to be <code>€</code>. This leads to the following on the Microsoft keyboard:<pre class=giallo style=color:#839496;background-color:#002b36><code data-lang=xml><span class=giallo-l><span style=color:#586e75;font-style:italic>&lt;!-- shift-` to € --></span></span>
<span class=giallo-l><span style=color:#586e75>&lt;</span><span style=color:#268bd2>autogen</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span>  __KeyToKey__</span></span>
<span class=giallo-l><span>  KeyCode::BACKQUOTE, ModifierFlag::SHIFT_L | ModifierFlag::NONE,</span></span>
<span class=giallo-l><span>  KeyCode::KEY_2, ModifierFlag::OPTION_R | ModifierFlag::SHIFT_R</span></span>
<span class=giallo-l><span style=color:#586e75>&lt;/</span><span style=color:#268bd2>autogen</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span style=color:#586e75>&lt;</span><span style=color:#268bd2>autogen</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span>  __KeyToKey__</span></span>
<span class=giallo-l><span>  KeyCode::BACKQUOTE, ModifierFlag::SHIFT_R | ModifierFlag::NONE,</span></span>
<span class=giallo-l><span>  KeyCode::KEY_2, ModifierFlag::OPTION_R | ModifierFlag::SHIFT_R</span></span>
<span class=giallo-l><span style=color:#586e75>&lt;/</span><span style=color:#268bd2>autogen</span><span style=color:#586e75>></span></span></code></pre><p>…but to the following on the Macbook built-in UK keyboard, to take account first of the different keycode it generates but also to ensure that when used with command and command-shift, the standard behaviour of cycling between windows works:<pre class=giallo style=color:#839496;background-color:#002b36><code data-lang=xml><span class=giallo-l><span style=color:#586e75;font-style:italic>&lt;!-- top-left § to ` --></span></span>
<span class=giallo-l><span style=color:#586e75>&lt;</span><span style=color:#268bd2>autogen</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span>  __KeyToKey__</span></span>
<span class=giallo-l><span>  KeyCode::DANISH_DOLLAR, ModifierFlag::NONE,</span></span>
<span class=giallo-l><span>  KeyCode::BACKQUOTE</span></span>
<span class=giallo-l><span style=color:#586e75>&lt;/</span><span style=color:#268bd2>autogen</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span style=color:#586e75;font-style:italic>&lt;!-- ...with shift, to € --></span></span>
<span class=giallo-l><span style=color:#586e75>&lt;</span><span style=color:#268bd2>autogen</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span>  __KeyToKey__</span></span>
<span class=giallo-l><span>  KeyCode::DANISH_DOLLAR, ModifierFlag::SHIFT_L | ModifierFlag::NONE,</span></span>
<span class=giallo-l><span>  KeyCode::KEY_2, ModifierFlag::OPTION_R | ModifierFlag::SHIFT_R</span></span>
<span class=giallo-l><span style=color:#586e75>&lt;/</span><span style=color:#268bd2>autogen</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span style=color:#586e75>&lt;</span><span style=color:#268bd2>autogen</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span>  __KeyToKey__</span></span>
<span class=giallo-l><span>  KeyCode::DANISH_DOLLAR, ModifierFlag::SHIFT_R | ModifierFlag::NONE,</span></span>
<span class=giallo-l><span>  KeyCode::KEY_2, ModifierFlag::OPTION_R | ModifierFlag::SHIFT_R</span></span>
<span class=giallo-l><span style=color:#586e75>&lt;/</span><span style=color:#268bd2>autogen</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span style=color:#586e75;font-style:italic>&lt;!-- ...with COMMAND/SHIFT, so that cycle-window-{forward,back} work --></span></span>
<span class=giallo-l><span style=color:#586e75>&lt;</span><span style=color:#268bd2>autogen</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span>  __KeyToKey__</span></span>
<span class=giallo-l><span>  KeyCode::DANISH_DOLLAR, ModifierFlag::COMMAND_L | ModifierFlag::NONE,</span></span>
<span class=giallo-l><span>  KeyCode::BACKQUOTE, ModifierFlag::COMMAND_R</span></span>
<span class=giallo-l><span style=color:#586e75>&lt;/</span><span style=color:#268bd2>autogen</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span style=color:#586e75>&lt;</span><span style=color:#268bd2>autogen</span><span style=color:#586e75>></span></span>
<span class=giallo-l><span>  __KeyToKey__</span></span>
<span class=giallo-l><span>  KeyCode::DANISH_DOLLAR, ModifierFlag::COMMAND_L | ModifierFlag::SHIFT_L | ModifierFlag::NONE,</span></span>
<span class=giallo-l><span>  KeyCode::BACKQUOTE, ModifierFlag::COMMAND_R | ModifierFlag::SHIFT_R</span></span>
<span class=giallo-l><span style=color:#586e75>&lt;/</span><span style=color:#268bd2>autogen</span><span style=color:#586e75>></span></span></code></pre><p>There are a number of other mappings made in <a href=https://github.com/mor1/rc-files/blob/master/karabiner.xml rel=external>karabiner.xml</a>: <code>shift-'</code> is <code>@</code>, <code>shift-2</code> is <code>"</code>, <code>shift-3</code> is <code>£</code>, and resolving general confusion among <code>#</code>, <code>\</code>, <code>~</code>, and <code>|</code>.<h3 id=emacs><a aria-label="Anchor link for: emacs" class=zola-anchor href=#emacs>Emacs</a></h3><p>That fixed things for the terminal and for most apps – the only remaining sticking point was Emacs. I don’t pretend to understand the entire chain of event processing but suffice it to say that Emacs was receiving <code>shift-@</code> and <code>shift-3</code> without knowing what to do with them. Fortunately, when coupled with <a href=https://github.com/mor1/rc-files/blob/master/emacs.d/init.el#L929-L1019 rel=external>my hacks to enforce a <code>my-keys-minor-mode</code> to override everything</a>, the fix was pretty straightforward:<pre class=giallo style=color:#839496;background-color:#002b36><code data-lang=common-lisp><span class=giallo-l><span>(define-key my-keys-minor-mode-map (kbd </span><span style=color:#2aa198>"s-@"</span><span>) </span><span style=color:#2aa198>"€"</span><span>)</span></span>
<span class=giallo-l><span>(define-key my-keys-minor-mode-map (kbd </span><span style=color:#2aa198>"s-3"</span><span>)</span></span>
<span class=giallo-l><span style=color:#268bd2>  '</span><span>(</span><span style=color:#93a1a1;font-weight:700>lambda</span><span> () (interactive) (insert-char </span><span style=color:#d33682>#x00A3</span><span>))) </span><span style=color:#586e75;font-style:italic>; £</span></span></code></pre><h3 id=result><a aria-label="Anchor link for: result" class=zola-anchor href=#result>Result?</a></h3><p>A <strong>significant</strong> decrease in the need I feel to curse because my keyboard has changed in the middle of typing! It seems that keyboards remain, like time and terminals, one of those <em>Really Hard</em> things for computers/manufacturers to handle…<p><em>Note: Thanks to <a href=http://www.amp-what.com/unicode/search/ rel=external>http://www.amp-what.com/unicode/search/</a> for an easy way to hunt down some of the unicode symbols used above!</em><nav><div><a href=https://mort.io/blog/local-knowledge/>‹ Local Knowledge</a></div><div><a href=https://mort.io/blog/bigtechday-mirage/> Fame and Fortune! ›</a></div></nav></article></main><footer><hr><div class=c><nav class=tpad><div><a title="mort’s mythopœia Atom Feed" href=https://mort.io/atom.xml target=_blank type=application/atom+xml><i class="svg rss" title="mort’s mythopœia Atom Feed" type=Button></i></a><a title="mort’s mythopœia RSS Feed" href=https://mort.io/rss.xml target=_blank type=application/rss+xml><i class="svg rss" title="mort’s mythopœia RSS Feed" type=Button></i></a><a href=mailto:richard.mortier@cl.cam.ac.uk target=_blank title=Mail><i class="svg mail" title=Mail type=Button></i></a><a href=https://mastodon.me.uk/@mort rel=me target=_blank title=Mastodon><i class="svg mastodon" title=Mastodon type=Button></i></a><a href=https://www.linkedin.com/in/richard-mortier/ target=_blank title=LinkedIn><i class="svg linkedin" title=LinkedIn type=Button></i></a><a href=https://github.com/mor1/ target=_blank title=Github><i class="svg github" title=Github type=Button></i></a><a href=https://hub.docker.com/u/mor1/ target=_blank title=Docker><i class="svg docker" title=Docker type=Button></i></a><a href="https://www.youtube.com/playlist?list=PLkRF0fgqvvMx5Owh1QgilmExGQe58go_u" target=_blank title=YouTube><i class="svg youtube" title=YouTube type=Button></i></a></div></nav><nav class=vpad><a class=rpad href=https://mort.io/sitemap.xml target=_blank> sitemap </a><a class=rpad href=https://mort.io/tags/> tags </a></nav><p class=s90>mort’s mythopœia © 2013—<span id=year>2026</span> Richard Mortier</div></footer><span class=topout> <span class=topleft> </span><a title="Back to Top" class=top href=#><i class="svgs svgh angu"></i></a> </span>