<!doctype html><html lang=en><head><link href="https://mort.io/abridge.css?h=ef0df812e427238e124c" rel=stylesheet><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1" name=viewport><meta content=https://mort.io name=base><meta content=True name=HandheldFriendly><meta content=yes name=mobile-web-app-capable><meta content=yes name=apple-mobile-web-app-capable><meta content=default name=apple-mobile-web-app-status-bar-style><link title="mort’s mythopœia Atom Feed" href=https://mort.io/atom.xml rel=alternate type=application/atom+xml><link title="mort’s mythopœia RSS Feed" href=https://mort.io/rss.xml rel=alternate type=application/rss+xml><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>OneDrive and NixOS | mort’s mythopœia</title><meta content="mort’s mythopœia" name=copyright><meta content="Setting up OneDrive under NixOS" name=description><link href=https://mort.io/blog/nixos-onedrive/ rel=canonical><meta content=https://mort.io/blog/nixos-onedrive/ property=og:url><meta content=https://mort.io/blog/nixos-onedrive/ name=twitter:url><meta content="Setting up OneDrive under NixOS" property=og:description><meta content="Setting up OneDrive under NixOS" name=twitter:description><meta content="OneDrive and NixOS | mort’s mythopœia" property=og:title><meta content="OneDrive and NixOS | mort’s mythopœia" name=twitter:title><meta content=summary name=twitter:card><meta content="mort’s mythopœia" property=og:site_name><meta content=en_US property=og:locale><meta content=website property=og:type><meta content=2023-08-22 property=og:updated_time><noscript><link href=https://mort.io/nojs.css rel=stylesheet></noscript><body><header><nav><div><big><a title="mort’s mythopœia" href=https://mort.io>mort’s mythopœia</a></big></div><div><div><ul><li><a class=s110 href=https://mort.io/research/> research </a><li><a class=s110 href=https://mort.io/students/> students </a><li><a class=s110 href=https://mort.io/teaching/> teaching </a><li><a class=s110 href=https://mort.io/codes/> codes </a><li><a class=s110 href=https://mort.io/me/> me </a></ul></div><div></div></div></nav><div class=desc>with apologies</div><hr></header><main><article><h1><a href=https://mort.io/blog/nixos-onedrive/>OneDrive and NixOS</a></h1><span class=s95><span class=hpad> ·</span> 2 min read<span class=hpad> ·</span> August 22, 2023<span class=hpad> ·</span> #<a href=https://mort.io/tags/old/>old</a> #<a href=https://mort.io/tags/tech/>tech</a> #<a href=https://mort.io/tags/linux/>linux</a> #<a href=https://mort.io/tags/nixos/>nixos</a> </span><nav><div><a href=https://mort.io/blog/nixos-channels/>‹ NixOS channels</a></div><div><a href=https://mort.io/blog/windows-wsl2/> WSL2 / Windows 11 ›</a></div></nav><p>Starting by reading instructions at:<ul><li><a href=https://github.com/abraunegg/onedrive/blob/master/docs/sharepoint-libraries.md>https://github.com/abraunegg/onedrive/blob/master/docs/sharepoint-libraries.md</a><li><a href=https://github.com/abraunegg/onedrive/blob/master/docs/business-shared-items.md>https://github.com/abraunegg/onedrive/blob/master/docs/business-shared-items.md</a><li><a href=https://github.com/NixOS/nixpkgs/pull/77734#issuecomment-575874225>https://github.com/NixOS/nixpkgs/pull/77734#issuecomment-575874225</a></ul><p>FWIW I also use that package on a NixOS system (via a Nix package that can presumably be installed on other systems if you add nix as a package manager), <a href=https://github.com/NixOS/nixpkgs/blob/master/nixos/modules/services/networking/onedrive.nix>https://github.com/NixOS/nixpkgs/blob/master/nixos/modules/services/networking/onedrive.nix</a>.<p>I have successfully used it with the University and my startup’s tenancies (both personal OneDrive and enterprise Sharepoint sites) simultaneously – this was fairly simple in the end but I recall it took a while to do the token dance to get the necessary tokens, and then to get all the runes right. In short it was something like:<ol><li><p>Follow the instructions Robert pointed to sort out access to the various accounts, refresh tokens, and the like.</p><li><p>Create file <code>~/.config/onedrive-launcher</code> comprising each subdirectory of <code>~/.config</code> that is a onedrive configuration directory corresponding to each account – I named these after the accounts in question so mine contained</p></ol><pre class="language-txt z-code" data-lang=txt><code class=language-txt data-lang=txt><span class="z-text z-plain">onedrive-rmm1002@cam.ac.uk
</span><span class="z-text z-plain">onedrive-mort@ikva.ai
</span><span class="z-text z-plain">sharepoint-mort@ikva.ai-iKVALimited
</span></code></pre><p>(I now prefix the last two lines with <code># </code> to comment them out as I don’t need those synced any more.)<p>The systemd service <code>onedrive-launcher.service</code> then uses the file to kick off a systemd <code>onedrive@...</code> service for each entry.<ol start=3><li>Edit the <code>~/.config/ACCOUNT/config</code> files appropriately; the only changes I made were to</ol><pre class="language-config z-code" data-lang=config><code class=language-config data-lang=config><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># for my University account
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">sync_dir</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-string z-quoted z-double z-genconfig">"~/OneDrive/rmm1002@cam.ac.uk"</span>
</span><span class="z-source z-genconfig">
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># for my startup personal OneDrive
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">sync_dir</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-string z-quoted z-double z-genconfig">"~/OneDrive/mort@ikva.ai"</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">sync_business_shared_folders</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-string z-quoted z-double z-genconfig">"true"</span>
</span><span class="z-source z-genconfig">﻿
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># for startup Sharepoint sites
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">sync_dir</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-string z-quoted z-double z-genconfig">"~/OneDrive/mort@ikva.ai-iKVA_Limited"</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">drive_id</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-string z-quoted z-double z-genconfig">"..."</span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># rune found per instructions Robert pointed to I think
</span></span></span></code></pre><nav><div><a href=https://mort.io/blog/nixos-channels/>‹ NixOS channels</a></div><div><a href=https://mort.io/blog/windows-wsl2/> WSL2 / Windows 11 ›</a></div></nav></article></main><footer><hr><div class=c><nav class=tpad><div><a title="mort’s mythopœia Atom Feed" href=https://mort.io/atom.xml target=_blank type=application/atom+xml><i class="svg rss" title="mort’s mythopœia Atom Feed" type=Button></i></a><a title="mort’s mythopœia RSS Feed" href=https://mort.io/rss.xml target=_blank type=application/rss+xml><i class="svg rss" title="mort’s mythopœia RSS Feed" type=Button></i></a><a href=mailto:richard.mortier@cl.cam.ac.uk target=_blank title=Mail><i class="svg mail" title=Mail type=Button></i></a><a href=https://mastodon.me.uk/@mort rel=me target=_blank title=Mastodon><i class="svg mastodon" title=Mastodon type=Button></i></a><a href=https://www.linkedin.com/in/richard-mortier/ target=_blank title=LinkedIn><i class="svg linkedin" title=LinkedIn type=Button></i></a><a href=https://github.com/mor1/ target=_blank title=Github><i class="svg github" title=Github type=Button></i></a><a href=https://hub.docker.com/u/mor1/ target=_blank title=Docker><i class="svg docker" title=Docker type=Button></i></a><a href="https://www.youtube.com/playlist?list=PLkRF0fgqvvMx5Owh1QgilmExGQe58go_u" target=_blank title=YouTube><i class="svg youtube" title=YouTube type=Button></i></a></div></nav><nav class=vpad><a class=rpad href=https://mort.io/sitemap.xml target=_blank> sitemap </a><a class=rpad href=https://mort.io/tags/> tags </a></nav><p class=s90>mort’s mythopœia © 2013—<span id=year>2025</span> Richard Mortier</div></footer>