<!doctype html><html lang=en><head><link href="https://mort.io/abridge.css?h=5f1494977bbccc1fddc1" rel=stylesheet><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1" name=viewport><meta content=https://mort.io name=base><meta content=True name=HandheldFriendly><meta content=yes name=mobile-web-app-capable><meta content=yes name=apple-mobile-web-app-capable><meta content=default name=apple-mobile-web-app-status-bar-style><link title="mort’s mythopœia Atom Feed" href=https://mort.io/atom.xml rel=alternate type=application/atom+xml><link title="mort’s mythopœia RSS Feed" href=https://mort.io/rss.xml rel=alternate type=application/rss+xml><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>Platforms, Packaging, Progress— Addendum | mort’s mythopœia</title><meta content="mort’s mythopœia" name=copyright><meta content="Fixing OPAM Release Metadata Errors" name=description><link href=https://mort.io/blog/topkg-addendum/ rel=canonical><meta content=https://mort.io/blog/topkg-addendum/ property=og:url><meta content=https://mort.io/blog/topkg-addendum/ name=twitter:url><meta content="Fixing OPAM Release Metadata Errors" property=og:description><meta content="Fixing OPAM Release Metadata Errors" name=twitter:description><meta content="Platforms, Packaging, Progress— Addendum | mort’s mythopœia" property=og:title><meta content="Platforms, Packaging, Progress— Addendum | mort’s mythopœia" name=twitter:title><meta content=summary name=twitter:card><meta content="mort’s mythopœia" property=og:site_name><meta content=en_US property=og:locale><meta content=website property=og:type><meta content=2017-09-01 property=og:updated_time><noscript><link href=https://mort.io/nojs.css rel=stylesheet></noscript><body><header><nav><div><big><a title="mort’s mythopœia" href=https://mort.io>mort’s mythopœia</a></big></div><div><div><ul><li><a class=s110 href=https://mort.io/research/> research </a><li><a class=s110 href=https://mort.io/students/> students </a><li><a class=s110 href=https://mort.io/teaching/> teaching </a><li><a class=s110 href=https://mort.io/codes/> codes </a><li><a class=s110 href=https://mort.io/me/> me </a></ul></div><div></div></div></nav><div class=desc>with apologies</div><hr></header><main><article><h1><a href=https://mort.io/blog/topkg-addendum/>Platforms, Packaging, Progress— Addendum</a></h1><span class=s95><span class=hpad> ·</span> 2 min read<span class=hpad> ·</span> September 01, 2017<span class=hpad> ·</span> #<a href=https://mort.io/tags/tech/>tech</a> #<a href=https://mort.io/tags/ocaml/>ocaml</a> #<a href=https://mort.io/tags/opam/>opam</a> #<a href=https://mort.io/tags/ocal/>ocal</a> </span><nav><div><a href=https://mort.io/blog/mess-with-my-keyboard/>‹ Spring Loading Karabiner in the Autumn</a></div><div><a href=https://mort.io/blog/past-present-future/> Platforms, Packaging, Progress ›</a></div></nav><p>This is a short addendum to my <a href=http://mort.io/blog/2017/08/28/past-present-future/ rel=external>post of a couple of days ago</a> caused by my carelessness in writing the <a href=https://github.com/mor1/ocal/blob/13a9a7f5b8f2e0be4c2b55941a00a885df202cf8/ocal.opam#L16-L22 rel=external>OPAM file</a>. Careful readers will observe the lack of any dependency on <a href=https://github.com/pqwy/notty/ rel=external>notty</a>. Read on for what happened next…<p>The result of this carelessness was that everything worked just fine locally, but <a href=https://github.com/ocaml/opam-repository/pull/10176 rel=external>my PR to the OPAM package repository</a> failed. Cue much wailing and gnashing of teeth.<p>However, thanks to a moment’s assistance from <a href=http://erratique.ch/contact.en rel=external>Daniel Bünzli</a>, this was easy to fix:<pre class=giallo style=color:#839496;background-color:#002b36><code data-lang=shellscript><span class=giallo-l><span style=color:#268bd2>$</span><span style=color:#2aa198> git checkout</span><span style=color:#d33682> 0.2.0</span><span style=color:#586e75;font-style:italic>       # checkout the relevant release version tag</span></span>
<span class=giallo-l><span style=color:#268bd2>$</span><span style=color:#2aa198> topkg opam pkg</span><span style=color:#586e75;font-style:italic>           # create the release metadata</span></span>
<span class=giallo-l><span style=color:#268bd2>$</span><span style=color:#2aa198> e _build/ocal.0.2.0/opam</span><span style=color:#586e75;font-style:italic> # invoke editor so I can add the missing dep</span></span>
<span class=giallo-l><span style=color:#268bd2>$</span><span style=color:#2aa198> topkg opam submit</span><span style=color:#586e75;font-style:italic>        # submit the updated OPAM metadata, updating the PR</span></span>
<span class=giallo-l><span style=color:#268bd2>Submitting</span><span style=color:#2aa198> _build/ocal.0.2.0</span></span>
<span class=giallo-l><span>[ocal-0.2.0.tbz] http://github.com/mor1/ocal/releases/download/0.2.0/ocal-0.2.0.tbz downloaded</span></span>
<span class=giallo-l><span style=color:#268bd2>Updating</span><span style=color:#2aa198> existing pull-request</span><span style=color:#586e75;font-style:italic> #10176</span></span>
<span class=giallo-l><span style=color:#268bd2>Pull-requested:</span><span style=color:#2aa198> https://github.com/ocaml/opam-repository/pull/10176</span></span></code></pre><p>For me, the main thing to note here is that the OPAM metadata in the repo at the commit ref tagged for release doesn’t match that which OPAM uses to install the release. But as <a href=http://seb.mondet.org/ rel=external>Sebastien Mondet</a> pointed out to me, this is neither relevant nor (in the long term) likely, as (e.g.) version constraints on dependencies may need to be added to old versions of dependent packages to keep them working. (Though I did add and commit the dependency to <code>master</code>, naturally.)<p>So, all-in-all, an easy fix to a common problem. Which is the way it should be…<nav><div><a href=https://mort.io/blog/mess-with-my-keyboard/>‹ Spring Loading Karabiner in the Autumn</a></div><div><a href=https://mort.io/blog/past-present-future/> Platforms, Packaging, Progress ›</a></div></nav></article></main><footer><hr><div class=c><nav class=tpad><div><a title="mort’s mythopœia Atom Feed" href=https://mort.io/atom.xml target=_blank type=application/atom+xml><i class="svg rss" title="mort’s mythopœia Atom Feed" type=Button></i></a><a title="mort’s mythopœia RSS Feed" href=https://mort.io/rss.xml target=_blank type=application/rss+xml><i class="svg rss" title="mort’s mythopœia RSS Feed" type=Button></i></a><a href=mailto:richard.mortier@cl.cam.ac.uk target=_blank title=Mail><i class="svg mail" title=Mail type=Button></i></a><a href=https://mastodon.me.uk/@mort rel=me target=_blank title=Mastodon><i class="svg mastodon" title=Mastodon type=Button></i></a><a href=https://www.linkedin.com/in/richard-mortier/ target=_blank title=LinkedIn><i class="svg linkedin" title=LinkedIn type=Button></i></a><a href=https://github.com/mor1/ target=_blank title=Github><i class="svg github" title=Github type=Button></i></a><a href=https://hub.docker.com/u/mor1/ target=_blank title=Docker><i class="svg docker" title=Docker type=Button></i></a><a href="https://www.youtube.com/playlist?list=PLkRF0fgqvvMx5Owh1QgilmExGQe58go_u" target=_blank title=YouTube><i class="svg youtube" title=YouTube type=Button></i></a></div></nav><nav class=vpad><a class=rpad href=https://mort.io/sitemap.xml target=_blank> sitemap </a><a class=rpad href=https://mort.io/tags/> tags </a></nav><p class=s90>mort’s mythopœia © 2013—<span id=year>2026</span> Richard Mortier</div></footer>