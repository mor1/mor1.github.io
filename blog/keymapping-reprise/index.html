<!doctype html><html lang=en><head><link href="https://mort.io/abridge.css?h=ef0df812e427238e124c" rel=stylesheet><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1" name=viewport><meta content=https://mort.io name=base><meta content=True name=HandheldFriendly><meta content=yes name=mobile-web-app-capable><meta content=yes name=apple-mobile-web-app-capable><meta content=default name=apple-mobile-web-app-status-bar-style><link title="mort’s mythopœia Atom Feed" href=https://mort.io/atom.xml rel=alternate type=application/atom+xml><link title="mort’s mythopœia RSS Feed" href=https://mort.io/rss.xml rel=alternate type=application/rss+xml><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>Re-key-remapping | mort’s mythopœia</title><meta content="mort’s mythopœia" name=copyright><meta content="Karabiner on Linux? `keyd`!" name=description><link href=https://mort.io/blog/keymapping-reprise/ rel=canonical><meta content=https://mort.io/blog/keymapping-reprise/ property=og:url><meta content=https://mort.io/blog/keymapping-reprise/ name=twitter:url><meta content="Karabiner on Linux? `keyd`!" property=og:description><meta content="Karabiner on Linux? `keyd`!" name=twitter:description><meta content="Re-key-remapping | mort’s mythopœia" property=og:title><meta content="Re-key-remapping | mort’s mythopœia" name=twitter:title><meta content=summary name=twitter:card><meta content="mort’s mythopœia" property=og:site_name><meta content=en_US property=og:locale><meta content=website property=og:type><meta content=2025-07-26 property=og:updated_time><noscript><link href=https://mort.io/nojs.css rel=stylesheet></noscript><body><header><nav><div><big><a title="mort’s mythopœia" href=https://mort.io>mort’s mythopœia</a></big></div><div><div><ul><li><a class=s110 href=https://mort.io/research/> research </a><li><a class=s110 href=https://mort.io/students/> students </a><li><a class=s110 href=https://mort.io/teaching/> teaching </a><li><a class=s110 href=https://mort.io/codes/> codes </a><li><a class=s110 href=https://mort.io/me/> me </a></ul></div><div></div></div></nav><div class=desc>with apologies</div><hr></header><main><article><h1><a href=https://mort.io/blog/keymapping-reprise/>Re-key-remapping</a></h1><span class=s95><span class=hpad> ·</span> 3 min read<span class=hpad> ·</span> July 26, 2025<span class=hpad> ·</span> #<a href=https://mort.io/tags/tech/>tech</a> #<a href=https://mort.io/tags/nixos/>nixos</a> #<a href=https://mort.io/tags/linux/>linux</a> #<a href=https://mort.io/tags/dotfiles/>dotfiles</a> #<a href=https://mort.io/tags/config/>config</a> </span><nav><div><a href=https://mort.io/blog/resize-swap/>‹ Resizing swap partition on NixOS</a></div><div><a href=https://mort.io/blog/whither-ai/> Whither AI? ›</a></div></nav><p>As all right-minded people must, I remap the historic, redundant, absurd <code>CAPSLOCK</code> key<sup class=footnote-reference><a href=#1>1</a></sup> to be a more conveniently accessible current, useful, sleek <code>CTRL</code> (control) key on any given keyboard. I also do some other minor mods to assist retention of the little sanity I still have – as I get older and more decrepit, it gets harder for me to handle change. Deal with it.<p>I <a href=/blog/elcapitan-maps/>used</a> <a href=/blog/mess-with-my-keyboard/>to do this</a> <a href=/blog/setup-new-laptop/>on my Macbook</a> using a tool called <a href=https://karabiner-elements.pqrs.org/>Karabiner Elements</a>. But now I’m on Linux, that’s not a thing. So I use the excellent <a href=https://github.com/rvaiya/keyd><code>keyd</code></a> instead. The UK Thinkpad keyboard being a lot less daft in design than the UK Macbook keyboard, the modifications are also much smaller, which is nice.<p>However the canonical First Modification, <code>CAPSLOCK</code> to <code>CONTROL</code> remains the key one. For added convenience, given I rarely need to “tap” <code>CTRL</code> I also make a tap on the <code>CAPSLOCK</code> key into an <code>ESC</code> (escape). And there the fun starts.<p>It turns out the <a href=https://github.com/rvaiya/keyd><code>keyd</code></a> recommended way to achieve this is with the configuration stanza<pre class="language-config z-code" data-lang=config><code class=language-config data-lang=config><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">[main]
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">capslock</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-meta z-function z-genconfig"><span class="z-entity z-name z-function z-genconfig">overload</span>(</span>capslock<span class="z-keyword z-operator z-genconfig">,</span> esc)
</span></code></pre><p>…which is mostly fine and has worked well for me for some time. But I realised I was getting increasingly irritated that I seemed to get spurious <code>ESC</code> key presses when using <code>CAPSLOCK</code> as <code>CTRL</code>. <code>sudo keyd monitor</code> and it became clear that the semantics of the <code>overload()</code> function weren’t quite as I thought. From <code>man keyd</code>,<pre class=z-code><code><span class="z-text z-plain">overload(&LTlayer>, &LTaction>)
</span><span class="z-text z-plain">    Activates the given layer while held and executes &LTaction> on tap.
</span></code></pre><p>I had assumed this meant that <code>&LTaction></code> did not execute if the assigned key was held, but it doesn’t quite: it seems that a tap is deemed to have occurred if the key is not <em>chorded</em>. So sometimes, being a bit slow, when I hold <code>CAPSLOCK</code> thinking I want to chord and thus have it treated as <code>CTRL</code> but then realise I don’t and I just let go, I still get an <code>ESC</code> generated – even if it was a second or two that I was holding it down for.<sup class=footnote-reference><a href=#2>2</a></sup><p>So I read a bit more of the manpage can came across the <code>timeout</code> function<pre class=z-code><code><span class="z-text z-plain">timeout(&LTaction 1>, &LTtimeout>, &LTaction 2>)
</span><span class="z-text z-plain">    If the key is held in isolation for more than &LTtimeout> ms, activate the
</span><span class="z-text z-plain">    second action, if the key is held for less than &LTtimeout> ms or another key
</span><span class="z-text z-plain">    is struck before &LTtimeout> ms expires, execute the first action.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">    E.g.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">    timeout(a, 500, layer(control))
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">    Will cause the assigned key to behave as control if it is held for more than
</span><span class="z-text z-plain">    500 ms.
</span></code></pre><p>…used as <code>capslock = timeout(esc, 250, layer(control))</code> but that turns out also not to be quite right. In the end, it looks like the right answer is <code>overloadt2</code>:<pre class=z-code><code><span class="z-text z-plain">overloadt(&LTlayer>, &LTaction>, &LTtimeout>)
</span><span class="z-text z-plain">    Identical to overload, but only activates the layer if the bound key is held
</span><span class="z-text z-plain">    for &LTtimeout> milliseconds. This is mainly useful for overloading keys which
</span><span class="z-text z-plain">    are commonly struck in sequence (e.g letter keys).
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">    Note that this will add a visual delay when typing, since overlapping keys
</span><span class="z-text z-plain">    will be queued until the timeout expires or the bound key is released.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">overloadt2(&LTlayer>, &LTaction>, &LTtimeout>)
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">    Identical to overloadt, but additionally resolves as a hold in the event of
</span><span class="z-text z-plain">    an intervening key tap.
</span></code></pre><p>The end result is the following stanza in my <a href=https://nixos.org/>NixOS</a> configuration:<pre class="language-nix z-code" data-lang=nix><code class=language-nix data-lang=nix><span class="z-source z-nix"><span class="z-variable z-parameter z-name z-nix">keyd</span> <span class="z-invalid z-illegal">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">enable</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">true</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">keyboards</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">default</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">ids</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>*<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">settings</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">main</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">        <span class="z-comment z-line z-number-sign z-nix"># capslock -> (held) ctrl, (tap) ESC</span>
</span><span class="z-source z-nix">        <span class="z-entity z-other z-attribute-name z-multipart z-nix">capslock</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>overloadt2(control, esc, 150)<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">        <span class="z-entity z-other z-attribute-name z-multipart z-nix">rightalt</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>leftalt<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">      <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">shift</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">        <span class="z-entity z-other z-attribute-name z-multipart z-nix">grave</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>G-4<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-comment z-line z-number-sign z-nix"># S-` -> €</span>
</span><span class="z-source z-nix">      <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-invalid z-illegal">;</span>
</span></code></pre><p>The <code>timeout</code> of 150ms feels “about right” at this point – 100ms was borderline not enough, and 200ms was definitely annoyingly long.<div class=footnote-definition id=1><sup class=footnote-definition-label>1</sup><p>Not to be confused with the elegant, historic, radical <code>RUN/STOP</code> key of course. C64 FTW!</div><div class=footnote-definition id=2><sup class=footnote-definition-label>2</sup><p>Honestly, sometimes I really am that slow. I’m old see?</div><nav><div><a href=https://mort.io/blog/resize-swap/>‹ Resizing swap partition on NixOS</a></div><div><a href=https://mort.io/blog/whither-ai/> Whither AI? ›</a></div></nav></article></main><footer><hr><div class=c><nav class=tpad><div><a title="mort’s mythopœia Atom Feed" href=https://mort.io/atom.xml target=_blank type=application/atom+xml><i class="svg rss" title="mort’s mythopœia Atom Feed" type=Button></i></a><a title="mort’s mythopœia RSS Feed" href=https://mort.io/rss.xml target=_blank type=application/rss+xml><i class="svg rss" title="mort’s mythopœia RSS Feed" type=Button></i></a><a href=mailto:richard.mortier@cl.cam.ac.uk target=_blank title=Mail><i class="svg mail" title=Mail type=Button></i></a><a href=https://mastodon.me.uk/@mort rel=me target=_blank title=Mastodon><i class="svg mastodon" title=Mastodon type=Button></i></a><a href=https://www.linkedin.com/in/richard-mortier/ target=_blank title=LinkedIn><i class="svg linkedin" title=LinkedIn type=Button></i></a><a href=https://github.com/mor1/ target=_blank title=Github><i class="svg github" title=Github type=Button></i></a><a href=https://hub.docker.com/u/mor1/ target=_blank title=Docker><i class="svg docker" title=Docker type=Button></i></a><a href="https://www.youtube.com/playlist?list=PLkRF0fgqvvMx5Owh1QgilmExGQe58go_u" target=_blank title=YouTube><i class="svg youtube" title=YouTube type=Button></i></a></div></nav><nav class=vpad><a class=rpad href=https://mort.io/sitemap.xml target=_blank> sitemap </a><a class=rpad href=https://mort.io/tags/> tags </a></nav><p class=s90>mort’s mythopœia © 2013—<span id=year>2025</span> Richard Mortier</div></footer><span class=topout> <span class=topleft> </span><a title="Back to Top" class=top href=#><i class="svgs svgh angu"></i></a> </span>