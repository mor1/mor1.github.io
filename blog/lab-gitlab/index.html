<!doctype html><html lang=en><head><link href="https://mort.io/abridge.css?h=ef0df812e427238e124c" rel=stylesheet><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1" name=viewport><meta content=https://mort.io name=base><meta content=True name=HandheldFriendly><meta content=yes name=mobile-web-app-capable><meta content=yes name=apple-mobile-web-app-capable><meta content=default name=apple-mobile-web-app-status-bar-style><link title="mort’s mythopœia Atom Feed" href=https://mort.io/atom.xml rel=alternate type=application/atom+xml><link title="mort’s mythopœia RSS Feed" href=https://mort.io/rss.xml rel=alternate type=application/rss+xml><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>Lab GitLab | mort’s mythopœia</title><meta content="mort’s mythopœia" name=copyright><meta content="Installing a GitLab VM in the Computer Lab" name=description><link href=https://mort.io/blog/lab-gitlab/ rel=canonical><meta content=https://mort.io/blog/lab-gitlab/ property=og:url><meta content=https://mort.io/blog/lab-gitlab/ name=twitter:url><meta content="Installing a GitLab VM in the Computer Lab" property=og:description><meta content="Installing a GitLab VM in the Computer Lab" name=twitter:description><meta content="Lab GitLab | mort’s mythopœia" property=og:title><meta content="Lab GitLab | mort’s mythopœia" name=twitter:title><meta content=summary name=twitter:card><meta content="mort’s mythopœia" property=og:site_name><meta content=en_US property=og:locale><meta content=website property=og:type><meta content=2017-04-19 property=og:updated_time><noscript><link href=https://mort.io/nojs.css rel=stylesheet></noscript><body><header><nav><div><big><a title="mort’s mythopœia" href=https://mort.io>mort’s mythopœia</a></big></div><div><div><ul><li><a class=s110 href=https://mort.io/research/> research </a><li><a class=s110 href=https://mort.io/students/> students </a><li><a class=s110 href=https://mort.io/teaching/> teaching </a><li><a class=s110 href=https://mort.io/codes/> codes </a><li><a class=s110 href=https://mort.io/me/> me </a></ul></div><div></div></div></nav><div class=desc>with apologies</div><hr></header><main><article><h1><a href=https://mort.io/blog/lab-gitlab/>Lab GitLab</a></h1><span class=s95><span class=hpad> ·</span> 2 min read<span class=hpad> ·</span> April 19, 2017<span class=hpad> ·</span> #<a href=https://mort.io/tags/tech/>tech</a> #<a href=https://mort.io/tags/config/>config</a> #<a href=https://mort.io/tags/old/>old</a> </span><nav><div><a href=https://mort.io/blog/docker-docker/>‹ Docker Docker</a></div><div><a href=https://mort.io/blog/google-screening/> Google screening ›</a></div></nav><p>Recently had cause to do this as part of the <a href=https://www.cl.cam.ac.uk/research/srg/>SRG’s</a> and <a href=https://ocamllabs.io/>OCaml Labs</a> infrastructure. Thought it might be useful to make some notes, so here they are! Assuming your local <code>sys-admin</code> has kindly created you a suitable VM running Ubuntu with login credentials, etc, read on…<p>Note that several commands that follow must be run as <code>root</code>, via use of <code>sudo</code> below. Given that, think twice before just cutting and pasting them in, obviously… And I am not held responsible for anything either way!<h2 id=install-docker><a aria-label="Anchor link for: install-docker" class=zola-anchor href=#install-docker>Install Docker</a></h2><p>On a new Ubuntu stretch/sid (testing) VM:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> lsb_release<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>drc</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Description:</span></span><span class="z-meta z-function-call z-arguments z-shell">	Ubuntu 16.04.1 LTS</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Release:</span></span><span class="z-meta z-function-call z-arguments z-shell">	16.04</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Codename:</span></span><span class="z-meta z-function-call z-arguments z-shell">	xenial</span>
</span></code></pre><p>Next, install up-to-date <a href=https://docker.com/>Docker</a>:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> apt-get install apt-transport-https ca-certificates</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">apt-key</span></span><span class="z-meta z-function-call z-arguments z-shell"> adv<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>keyserver</span> hkp://p80.pool.sks-keyservers.net:80 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">        --</span>recv-keys</span> 58118E89F3A912897C070ADBF76221572C52609D</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> echo <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>deb https://apt.dockerproject.org/repo debian-stretch main<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell">     <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> /etc/apt/sources.list.d/docker.list</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> apt-get update</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> apt-get install<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>y</span> docker-engine</span>
</span></code></pre><p>Tweak the <code>systemd</code> <a href=https://docker.com/>Docker</a> configuration by adding a fragment to point all <a href=https://docker.com/>Docker</a> to the <code>/data</code> partition, lest the root partition <code>/</code> fill:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cat</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> /etc/systemd/system/docker.service.d/data-disk.conf <span class="z-string z-unquoted z-heredoc z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell"><<</span><span class="z-keyword z-control z-heredoc-token z-shell">EOF</span></span><span class="z-string z-unquoted z-heredoc z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">[Service]
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">ExecStart=
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">ExecStart=/usr/bin/dockerd -H fd:// -g /data/docker
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell"><span class="z-keyword z-control z-heredoc-token z-shell">EOF</span></span></span>
</span></code></pre><p>Then start the <a href=https://docker.com/>Docker</a> daemon and run <code>hello-world</code> just to check all is well:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> systemctl daemon-reload</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> service docker start</span>
</span></code></pre><p>Finally, test the install by running <code>hello-world</code>:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> docker run hello-world</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Hello</span></span><span class="z-meta z-function-call z-arguments z-shell"> from Docker!</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">This</span></span><span class="z-meta z-function-call z-arguments z-shell"> message shows that your installation appears to be working correctly.</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">To</span></span><span class="z-meta z-function-call z-arguments z-shell"> generate this message, Docker took the following steps:</span>
</span><span class="z-source z-shell z-bash"> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">1.</span></span><span class="z-meta z-function-call z-arguments z-shell"> The Docker client contacted the Docker daemon.</span>
</span><span class="z-source z-shell z-bash"> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">2.</span></span><span class="z-meta z-function-call z-arguments z-shell"> The Docker daemon pulled the <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>hello-world<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> image from the Docker Hub.</span>
</span><span class="z-source z-shell z-bash"> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">3.</span></span><span class="z-meta z-function-call z-arguments z-shell"> The Docker daemon created a new container from that image which runs the</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">executable</span></span><span class="z-meta z-function-call z-arguments z-shell"> that produces the output you are currently reading.</span>
</span><span class="z-source z-shell z-bash"> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">4.</span></span><span class="z-meta z-function-call z-arguments z-shell"> The Docker daemon streamed that output to the Docker client, which sent it</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">to</span></span><span class="z-meta z-function-call z-arguments z-shell"> your terminal.</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">To</span></span><span class="z-meta z-function-call z-arguments z-shell"> try something more ambitious, you can run an Ubuntu container with:</span>
</span><span class="z-source z-shell z-bash"> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> docker run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>it</span> ubuntu bash</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Share</span></span><span class="z-meta z-function-call z-arguments z-shell"> images, automate workflows, and more with a free Docker Hub account:</span>
</span><span class="z-source z-shell z-bash"> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">https://hub.docker.com</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">For</span></span><span class="z-meta z-function-call z-arguments z-shell"> more examples and ideas, visit:</span>
</span><span class="z-source z-shell z-bash"> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">https://docs.docker.com/engine/userguide/</span></span>
</span></code></pre><p>If appropriate, you may also wish to add yourself to the <code>docker</code> user group:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> usermod<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>aG</span> docker <span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">whoami</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span></code></pre><h2 id=gitlab><a aria-label="Anchor link for: gitlab" class=zola-anchor href=#gitlab>GitLab</a></h2><p>Assuming you have rights to run <code>docker</code>, install and run Gitlab-CE:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">S</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">128.232.xxx.yyy</span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">H</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">gitlab.srg.cl.cam.ac.uk</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>detach</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">     --</span>hostname</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">H</span></span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">     --</span>publish</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">S</span></span>:443:443 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">     --</span>publish</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">S</span></span>:80:80 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">     --</span>publish</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">S</span></span>:2222:22 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">     --</span>name</span> gitlab <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">     --</span>restart</span> always <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">     --</span>volume</span> /data/gitlab/config:/etc/gitlab <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">     --</span>volume</span> /data/gitlab/logs:/var/log/gitlab <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">     --</span>volume</span> /data/gitlab/data:/var/opt/gitlab <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">     --</span>volume</span> /data/gitlab/backups:/var/opt/gitlab/backups <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">     --</span>volume</span> /data/gitlab/sync:/var/opt/gitlab/sync <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">     --</span>env</span> HOST_UID=<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-language z-shell">$</span></span>(id<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>u</span></span><span class="z-meta z-function-call z-shell"></span>) <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">--env</span></span><span class="z-meta z-function-call z-arguments z-shell"> HOST_GID=<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-language z-shell">$</span></span>(id<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>g</span></span><span class="z-meta z-function-call z-shell"></span>) <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">     <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mor1/gitlab-ce-cron:latest</span></span>
</span></code></pre><p>…or use the <code>make start</code> target in the <a href=https://github.com/mor1/dockerfiles/blob/master/gitlab-ce-cron/Makefile>Makefile</a> in the related <a href=https://github.com/mor1/dockerfiles/tree/master/gitlab-ce-cron>GitHub repo</a>.<h2 id=tls-certificates><a aria-label="Anchor link for: tls-certificates" class=zola-anchor href=#tls-certificates>TLS Certificates</a></h2><p>Self-certified certificates:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">openssl</span></span><span class="z-meta z-function-call z-arguments z-shell"> req<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>nodes</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>newkey</span> rsa:2048<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>keyout</span> gitlab.srg.cl.cam.ac.uk.key<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>out</span> gitlab.srg.cl.cam.ac.uk.csr</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-cd z-shell">cd</span></span><span class="z-meta z-function-call z-arguments z-shell"> ssl</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">chmod</span></span><span class="z-meta z-function-call z-arguments z-shell"> 600 <span class="z-keyword z-operator z-regexp z-quantifier z-shell">*</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">openssl</span></span><span class="z-meta z-function-call z-arguments z-shell"> x509<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>req</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>days</span> 1460<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>in</span> gitlab.srg.cl.cam.ac.uk.csr<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>signkey</span> gitlab.srg.cl.cam.ac.uk.key<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>out</span> gitlab.srg.cl.cam.ac.uk.crt</span>
</span></code></pre><h2 id=run-backups><a aria-label="Anchor link for: run-backups" class=zola-anchor href=#run-backups>Run Backups</a></h2><ul><li><code>backup</code> script to create backup tarballs and extract<li><code>sync</code> script to rsync extracted tarballs to filer</ul><h2 id=recovering-password><a aria-label="Anchor link for: recovering-password" class=zola-anchor href=#recovering-password>Recovering Password</a></h2><p>To change the <code>root</code> password you need to use the Ruby-on-Rails console to access the relevant object, modify it, and save it back:<pre class="language-ruby z-code" data-lang=ruby><code class=language-ruby data-lang=ruby><span class="z-source z-ruby">gitlab<span class="z-keyword z-operator z-arithmetic z-ruby">-</span>rails console production
</span><span class="z-source z-ruby">
</span><span class="z-source z-ruby">irb<span class="z-punctuation z-definition z-group z-begin z-ruby">(</span>main<span class="z-punctuation z-definition z-group z-end z-ruby">)</span><span class="z-keyword z-operator z-conditional z-ruby">:</span><span class="z-constant z-numeric z-integer z-octal z-ruby"><span class="z-punctuation z-definition z-numeric z-base z-ruby">0</span>01</span><span class="z-keyword z-operator z-conditional z-ruby">:</span><span class="z-constant z-numeric z-integer z-decimal z-ruby">0</span><span class="z-keyword z-operator z-comparison z-ruby">></span> user <span class="z-keyword z-operator z-assignment z-ruby">=</span> <span class="z-support z-class z-ruby">User</span><span class="z-punctuation z-accessor z-dot z-ruby">.</span>where<span class="z-punctuation z-definition z-group z-begin z-ruby">(</span><span class="z-constant z-other z-symbol z-ruby">id<span class="z-punctuation z-definition z-constant z-ruby">:</span></span> <span class="z-constant z-numeric z-integer z-decimal z-ruby">1</span><span class="z-punctuation z-definition z-group z-end z-ruby">)</span><span class="z-punctuation z-accessor z-dot z-ruby">.</span>first
</span><span class="z-source z-ruby"><span class="z-punctuation z-separator z-key-value z-ruby">=></span> <span class="z-comment z-line z-number-sign z-ruby"><span class="z-punctuation z-definition z-comment z-ruby">#</span>&LTUser id: 1, email: "admin@example.com", created_at: "2016-11-16 22:57:21", updated_at: "2016-12-05 23:42:50", name: "Administrator", admin: true, projects_limit: 10, skype: "", linkedin: "", twitter: "", authentication_token: "secrettoken", theme_id: 2, bio: nil, username: "root", can_create_group: true, can_create_team: false, state: "active", color_scheme_id: 1, password_expires_at: nil, created_by_id: nil, last_credential_check_at: nil, avatar: nil, hide_no_ssh_key: false, website_url: "", notification_email: "admin@example.com", hide_no_password: false, password_automatically_set: false, location: nil, encrypted_otp_secret: nil, encrypted_otp_secret_iv: nil, encrypted_otp_secret_salt: nil, otp_required_for_login: false, otp_backup_codes: nil, public_email: "", dashboard: 0, project_view: 0, consumed_timestep: nil, layout: 0, hide_project_limit: false, otp_grace_period_started_at: nil, ldap_email: false, external: false, organization: nil>
</span></span><span class="z-source z-ruby">irb<span class="z-punctuation z-definition z-group z-begin z-ruby">(</span>main<span class="z-punctuation z-definition z-group z-end z-ruby">)</span><span class="z-keyword z-operator z-conditional z-ruby">:</span><span class="z-constant z-numeric z-integer z-octal z-ruby"><span class="z-punctuation z-definition z-numeric z-base z-ruby">0</span>02</span><span class="z-keyword z-operator z-conditional z-ruby">:</span><span class="z-constant z-numeric z-integer z-decimal z-ruby">0</span><span class="z-keyword z-operator z-comparison z-ruby">></span> user<span class="z-punctuation z-accessor z-dot z-ruby">.</span>password <span class="z-keyword z-operator z-assignment z-ruby">=</span> <span class="z-meta z-string z-ruby"><span class="z-string z-quoted z-single z-ruby"><span class="z-punctuation z-definition z-string z-begin z-ruby">'</span>secretpassword<span class="z-punctuation z-definition z-string z-end z-ruby">'</span></span></span>
</span><span class="z-source z-ruby"><span class="z-punctuation z-separator z-key-value z-ruby">=></span> <span class="z-meta z-string z-ruby"><span class="z-string z-quoted z-double z-ruby"><span class="z-punctuation z-definition z-string z-begin z-ruby">"</span>secretpassword<span class="z-punctuation z-definition z-string z-end z-ruby">"</span></span></span>
</span><span class="z-source z-ruby">irb<span class="z-punctuation z-definition z-group z-begin z-ruby">(</span>main<span class="z-punctuation z-definition z-group z-end z-ruby">)</span><span class="z-keyword z-operator z-conditional z-ruby">:</span><span class="z-constant z-numeric z-integer z-octal z-ruby"><span class="z-punctuation z-definition z-numeric z-base z-ruby">0</span>03</span><span class="z-keyword z-operator z-conditional z-ruby">:</span><span class="z-constant z-numeric z-integer z-decimal z-ruby">0</span><span class="z-keyword z-operator z-comparison z-ruby">></span> user<span class="z-punctuation z-accessor z-dot z-ruby">.</span>password_confirmation <span class="z-keyword z-operator z-assignment z-ruby">=</span> <span class="z-meta z-string z-ruby"><span class="z-string z-quoted z-single z-ruby"><span class="z-punctuation z-definition z-string z-begin z-ruby">'</span>secretpassword<span class="z-punctuation z-definition z-string z-end z-ruby">'</span></span></span>
</span><span class="z-source z-ruby"><span class="z-punctuation z-separator z-key-value z-ruby">=></span> <span class="z-meta z-string z-ruby"><span class="z-string z-quoted z-double z-ruby"><span class="z-punctuation z-definition z-string z-begin z-ruby">"</span>secretpassword<span class="z-punctuation z-definition z-string z-end z-ruby">"</span></span></span>
</span><span class="z-source z-ruby">irb<span class="z-punctuation z-definition z-group z-begin z-ruby">(</span>main<span class="z-punctuation z-definition z-group z-end z-ruby">)</span><span class="z-keyword z-operator z-conditional z-ruby">:</span><span class="z-constant z-numeric z-integer z-octal z-ruby"><span class="z-punctuation z-definition z-numeric z-base z-ruby">0</span>04</span><span class="z-keyword z-operator z-conditional z-ruby">:</span><span class="z-constant z-numeric z-integer z-decimal z-ruby">0</span><span class="z-keyword z-operator z-comparison z-ruby">></span> user<span class="z-punctuation z-accessor z-dot z-ruby">.</span>save!
</span><span class="z-source z-ruby"><span class="z-variable z-other z-constant z-ruby">Enqueued</span> <span class="z-support z-class z-ruby">ActionMailer</span><span class="z-punctuation z-accessor z-double-colon z-ruby">::</span>DeliveryJob <span class="z-punctuation z-definition z-group z-begin z-ruby">(</span><span class="z-variable z-other z-constant z-ruby">Job</span> <span class="z-constant z-other z-symbol z-ruby">ID<span class="z-punctuation z-definition z-constant z-ruby">:</span></span> 5f74573d<span class="z-keyword z-operator z-arithmetic z-ruby">-</span>dfa2<span class="z-keyword z-operator z-arithmetic z-ruby">-</span><span class="z-constant z-numeric z-integer z-decimal z-ruby">4778</span><span class="z-keyword z-operator z-arithmetic z-ruby">-</span>b365<span class="z-keyword z-operator z-arithmetic z-ruby">-</span>cbebd88e454e<span class="z-punctuation z-definition z-group z-end z-ruby">)</span> to <span class="z-variable z-other z-constant z-ruby">Sidekiq</span><span class="z-punctuation z-definition z-group z-begin z-ruby">(</span>mailers<span class="z-punctuation z-definition z-group z-end z-ruby">)</span> with <span class="z-constant z-other z-symbol z-ruby">arguments<span class="z-punctuation z-definition z-constant z-ruby">:</span></span> <span class="z-meta z-string z-ruby"><span class="z-string z-quoted z-double z-ruby"><span class="z-punctuation z-definition z-string z-begin z-ruby">"</span>DeviseMailer<span class="z-punctuation z-definition z-string z-end z-ruby">"</span></span></span><span class="z-punctuation z-separator z-sequence z-ruby">,</span> <span class="z-meta z-string z-ruby"><span class="z-string z-quoted z-double z-ruby"><span class="z-punctuation z-definition z-string z-begin z-ruby">"</span>password_change<span class="z-punctuation z-definition z-string z-end z-ruby">"</span></span></span><span class="z-punctuation z-separator z-sequence z-ruby">,</span> <span class="z-meta z-string z-ruby"><span class="z-string z-quoted z-double z-ruby"><span class="z-punctuation z-definition z-string z-begin z-ruby">"</span>deliver_now<span class="z-punctuation z-definition z-string z-end z-ruby">"</span></span></span><span class="z-punctuation z-separator z-sequence z-ruby">,</span> <span class="z-constant z-other z-symbol z-ruby">gid<span class="z-punctuation z-definition z-constant z-ruby">:</span></span><span class="z-meta z-string z-regexp z-ruby"><span class="z-string z-regexp z-classic z-ruby"><span class="z-punctuation z-definition z-string z-begin z-ruby">/</span><span class="z-punctuation z-definition z-string z-end z-ruby">/</span></span></span>gitlab<span class="z-keyword z-operator z-arithmetic z-ruby">/</span><span class="z-variable z-other z-constant z-ruby">User</span><span class="z-keyword z-operator z-arithmetic z-ruby">/</span><span class="z-constant z-numeric z-integer z-decimal z-ruby">1</span>
</span><span class="z-source z-ruby"><span class="z-punctuation z-separator z-key-value z-ruby">=></span> <span class="z-constant z-language z-ruby">true</span>
</span><span class="z-source z-ruby">irb<span class="z-punctuation z-definition z-group z-begin z-ruby">(</span>main<span class="z-punctuation z-definition z-group z-end z-ruby">)</span><span class="z-keyword z-operator z-conditional z-ruby">:</span><span class="z-constant z-numeric z-integer z-octal z-ruby"><span class="z-punctuation z-definition z-numeric z-base z-ruby">0</span>05</span><span class="z-keyword z-operator z-conditional z-ruby">:</span><span class="z-constant z-numeric z-integer z-decimal z-ruby">0</span><span class="z-keyword z-operator z-comparison z-ruby">></span>
</span><span class="z-source z-ruby">
</span><span class="z-source z-ruby">gitlab<span class="z-keyword z-operator z-arithmetic z-ruby">-</span>ctl reconfigure
</span></code></pre><h2 id=hook-up-to-github><a aria-label="Anchor link for: hook-up-to-github" class=zola-anchor href=#hook-up-to-github>Hook up to GitHub</a></h2><p>Per <a href=https://docs.gitlab.com/ce/integration/omniauth.html#initial-omniauth-configuration>https://docs.gitlab.com/ce/integration/omniauth.html#initial-omniauth-configuration</a> and <a href=https://docs.gitlab.com/ce/integration/github.html>https://docs.gitlab.com/ce/integration/github.html</a>:<p>Edit via <code>sudo docker exec -it gitlab /bin/bash</code>:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">root@gitlab:/#</span></span><span class="z-meta z-function-call z-arguments z-shell"> vi /etc/gitlab/gitlab.rb</span>
</span></code></pre><pre class="language-ruby z-code" data-lang=ruby><code class=language-ruby data-lang=ruby><span class="z-source z-ruby">gitlab_rails<span class="z-punctuation z-section z-array z-ruby">[</span><span class="z-meta z-string z-ruby"><span class="z-string z-quoted z-single z-ruby"><span class="z-punctuation z-definition z-string z-begin z-ruby">'</span>omniauth_enabled<span class="z-punctuation z-definition z-string z-end z-ruby">'</span></span></span><span class="z-punctuation z-section z-array z-ruby">]</span> <span class="z-keyword z-operator z-assignment z-ruby">=</span> <span class="z-constant z-language z-ruby">true</span>
</span><span class="z-source z-ruby">gitlab_rails<span class="z-punctuation z-section z-array z-ruby">[</span><span class="z-meta z-string z-ruby"><span class="z-string z-quoted z-single z-ruby"><span class="z-punctuation z-definition z-string z-begin z-ruby">'</span>omniauth_allow_single_sign_on<span class="z-punctuation z-definition z-string z-end z-ruby">'</span></span></span><span class="z-punctuation z-section z-array z-ruby">]</span> <span class="z-keyword z-operator z-assignment z-ruby">=</span> <span class="z-punctuation z-section z-array z-ruby">[</span><span class="z-meta z-string z-ruby"><span class="z-string z-quoted z-single z-ruby"><span class="z-punctuation z-definition z-string z-begin z-ruby">'</span>saml<span class="z-punctuation z-definition z-string z-end z-ruby">'</span></span></span><span class="z-punctuation z-separator z-sequence z-ruby">,</span> <span class="z-meta z-string z-ruby"><span class="z-string z-quoted z-single z-ruby"><span class="z-punctuation z-definition z-string z-begin z-ruby">'</span>github<span class="z-punctuation z-definition z-string z-end z-ruby">'</span></span></span><span class="z-punctuation z-section z-array z-ruby">]</span>
</span><span class="z-source z-ruby">gitlab_rails<span class="z-punctuation z-section z-array z-ruby">[</span><span class="z-meta z-string z-ruby"><span class="z-string z-quoted z-single z-ruby"><span class="z-punctuation z-definition z-string z-begin z-ruby">'</span>omniauth_block_auto_created_users<span class="z-punctuation z-definition z-string z-end z-ruby">'</span></span></span><span class="z-punctuation z-section z-array z-ruby">]</span> <span class="z-keyword z-operator z-assignment z-ruby">=</span> <span class="z-constant z-language z-ruby">true</span>
</span></code></pre><h2 id=email><a aria-label="Anchor link for: email" class=zola-anchor href=#email>Email</a></h2><p>Use SMTP via &LTppsw.cam.ac.uk>, for which the from address must have a valid <code>MX</code> record <strong>and</strong> not be under &LTcam.ac.uk> per <a href=http://help.uis.cam.ac.uk/email-telephony-and-collaboration/email/technical/sending>http://help.uis.cam.ac.uk/email-telephony-and-collaboration/email/technical/sending</a>.<p>Configuration can be tested via the console:<pre class="language-ruby z-code" data-lang=ruby><code class=language-ruby data-lang=ruby><span class="z-source z-ruby"><span class="z-support z-class z-ruby">Notify</span><span class="z-punctuation z-accessor z-dot z-ruby">.</span>test_email<span class="z-punctuation z-definition z-group z-begin z-ruby">(</span><span class="z-meta z-string z-ruby"><span class="z-string z-quoted z-single z-ruby"><span class="z-punctuation z-definition z-string z-begin z-ruby">'</span>your@email.address, <span class="z-punctuation z-definition z-string z-end z-ruby">'</span></span></span><span class="z-variable z-other z-constant z-ruby">Hello</span> <span class="z-variable z-other z-constant z-ruby">World</span><span class="z-meta z-string z-ruby"><span class="z-string z-quoted z-single z-ruby"><span class="z-punctuation z-definition z-string z-begin z-ruby">'</span>, <span class="z-punctuation z-definition z-string z-end z-ruby">'</span></span></span><span class="z-variable z-other z-constant z-ruby">This</span> is a <span class="z-support z-function z-builtin z-ruby">test</span> message<span class="z-meta z-string z-ruby"><span class="z-string z-quoted z-single z-ruby"><span class="z-punctuation z-definition z-string z-begin z-ruby">'</span>).deliver_now
</span></span></span></code></pre><nav><div><a href=https://mort.io/blog/docker-docker/>‹ Docker Docker</a></div><div><a href=https://mort.io/blog/google-screening/> Google screening ›</a></div></nav></article></main><footer><hr><div class=c><nav class=tpad><div><a title="mort’s mythopœia Atom Feed" href=https://mort.io/atom.xml target=_blank type=application/atom+xml><i class="svg rss" title="mort’s mythopœia Atom Feed" type=Button></i></a><a title="mort’s mythopœia RSS Feed" href=https://mort.io/rss.xml target=_blank type=application/rss+xml><i class="svg rss" title="mort’s mythopœia RSS Feed" type=Button></i></a><a href=mailto:richard.mortier@cl.cam.ac.uk target=_blank title=Mail><i class="svg mail" title=Mail type=Button></i></a><a href=https://mastodon.me.uk/@mort rel=me target=_blank title=Mastodon><i class="svg mastodon" title=Mastodon type=Button></i></a><a href=https://www.linkedin.com/in/richard-mortier/ target=_blank title=LinkedIn><i class="svg linkedin" title=LinkedIn type=Button></i></a><a href=https://github.com/mor1/ target=_blank title=Github><i class="svg github" title=Github type=Button></i></a><a href=https://hub.docker.com/u/mor1/ target=_blank title=Docker><i class="svg docker" title=Docker type=Button></i></a><a href="https://www.youtube.com/playlist?list=PLkRF0fgqvvMx5Owh1QgilmExGQe58go_u" target=_blank title=YouTube><i class="svg youtube" title=YouTube type=Button></i></a></div></nav><nav class=vpad><a class=rpad href=https://mort.io/sitemap.xml target=_blank> sitemap </a><a class=rpad href=https://mort.io/tags/> tags </a></nav><p class=s90>mort’s mythopœia © 2013—<span id=year>2025</span> Richard Mortier</div></footer>